<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>MongoDB基础操作 | 尚武</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MongoDB基础操作</h1><a id="logo" href="/.">尚武</a><p class="description">炳文博客</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 主页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/tasks/"><i class="fa fa-tasks"> 任务</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">MongoDB基础操作</h1><div class="post-meta">Jul 22, 2018<span> | </span><span class="category"><a href="/categories/技术/">技术</a></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#MOGNODB基本操作"><span class="toc-number">1.</span> <span class="toc-text">MOGNODB基本操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-MONGODB自带SHELL客户端"><span class="toc-number">1.1.</span> <span class="toc-text">1. MONGODB自带SHELL客户端</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-创建-删除数据库"><span class="toc-number">1.2.</span> <span class="toc-text">2. 创建/删除数据库</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-创建-删除集合"><span class="toc-number">1.3.</span> <span class="toc-text">3. 创建/删除集合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-数据类型"><span class="toc-number">1.4.</span> <span class="toc-text">4. 数据类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-插入文档"><span class="toc-number">1.5.</span> <span class="toc-text">5. 插入文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-查询文档"><span class="toc-number">1.6.</span> <span class="toc-text">6. 查询文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#6-1-基础查询语法"><span class="toc-number">1.6.1.</span> <span class="toc-text">6.1 基础查询语法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-2-Limit和Skip"><span class="toc-number">1.6.2.</span> <span class="toc-text">6.2 Limit和Skip</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-3-MONGODB排序-distinct"><span class="toc-number">1.6.3.</span> <span class="toc-text">6.3 MONGODB排序/distinct</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-4-MONGODB聚合"><span class="toc-number">1.6.4.</span> <span class="toc-text">6.4 MONGODB聚合</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-1-aggregate语法"><span class="toc-number">1.6.4.1.</span> <span class="toc-text">6.4.1 aggregate语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-2-管道"><span class="toc-number">1.6.4.2.</span> <span class="toc-text">6.4.2 管道</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-2-1-project"><span class="toc-number">1.6.4.2.1.</span> <span class="toc-text">6.4.2.1 $project</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-2-2-match"><span class="toc-number">1.6.4.2.2.</span> <span class="toc-text">6.4.2.2 $match</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-2-3-group"><span class="toc-number">1.6.4.2.3.</span> <span class="toc-text">6.4.2.3 $group</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-2-4-unwind"><span class="toc-number">1.6.4.2.4.</span> <span class="toc-text">6.4.2.4 $unwind</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-2-4-lookup"><span class="toc-number">1.6.4.2.5.</span> <span class="toc-text">6.4.2.4 $lookup</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#6-4-2-4-out"><span class="toc-number">1.6.4.2.6.</span> <span class="toc-text">6.4.2.4 $out</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-更新-删除文档"><span class="toc-number">1.7.</span> <span class="toc-text">7. 更新/删除文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-索引"><span class="toc-number">1.8.</span> <span class="toc-text">8. 索引</span></a></li></ol></li></ol></div></div><div class="post-content"><h1 id="MOGNODB基本操作"><a href="#MOGNODB基本操作" class="headerlink" title="MOGNODB基本操作"></a>MOGNODB基本操作</h1><hr>
<h2 id="1-MONGODB自带SHELL客户端"><a href="#1-MONGODB自带SHELL客户端" class="headerlink" title="1. MONGODB自带SHELL客户端"></a>1. MONGODB自带SHELL客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">## 切换到mongo账号</span><br><span class="line">[root@tst01 ~]# su - mongod</span><br><span class="line">## 进入mongod shell客户端  </span><br><span class="line">tst01 mongod&gt;mongo</span><br><span class="line">MongoDB shell version v3.4.10</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.10</span><br><span class="line">Server has startup warnings:</span><br><span class="line">2018-06-02T09:51:06.712+0800 I STORAGE  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.712+0800 I STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine</span><br><span class="line">2018-06-02T09:51:06.712+0800 I STORAGE  [initandlisten] **          See http://dochub.mongodb.org/core/prodnotes-filesystem</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 1024 processes, 64000 files. Number of processes should be at                       least 32000 : 0.5 times number of files.</span><br><span class="line">## 显示当前mongod服务器数据库</span><br><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">## 查看当前数据库的名称</span><br><span class="line">MongoDB Enterprise &gt; db</span><br><span class="line">test</span><br><span class="line">## 显示当前数据库的所有集合</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">## 切换到foolbar数据库,如果foolbar数据库不存在,会在该数据第一次插入之后创建</span><br><span class="line">MongoDB Enterprise &gt; use foolbar</span><br><span class="line">switched to db foolbar</span><br><span class="line">##  显示当前数据库中有哪些集合,起初应该是为NULL，但我们在创建mongod服务器时，有测试连接型的时候创建个集合,因此能看到blog集合</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">blog</span><br><span class="line">## 入数据会创建数据库(集合) 插入的数据是一个文档  </span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;title&quot;:&quot;mongodb shell client&quot;&#125;);</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">## 查找当前数据库中blog集合的所有文档</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;docment&quot;:&quot;welcome to use mongodb shell client&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c838c4dbabca2ce3b2a9&quot;), &quot;docment&quot; : &quot;welcome to use mongodb shell client&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;title&quot;:&quot;my test&quot;,&quot;name&quot;:&quot;pc&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;title&quot;:&quot;my test&quot;,&quot;name&quot;:&quot;pc&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;name&quot;:&quot;bowenz&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;name&quot;:&quot;bowenz&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c838c4dbabca2ce3b2a9&quot;), &quot;docment&quot; : &quot;welcome to use mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c86dc4dbabca2ce3b2aa&quot;), &quot;title&quot; : &quot;my test&quot;, &quot;name&quot; : &quot;pc&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c873c4dbabca2ce3b2ab&quot;), &quot;title&quot; : &quot;my test&quot;, &quot;name&quot; : &quot;pc&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c888c4dbabca2ce3b2ac&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c88bc4dbabca2ce3b2ad&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">## 从当前数据库中的blog集合中移除_id为ObjectId(&quot;5b12c86dc4dbabca2ce3b2aa&quot;)的文档</span><br><span class="line">MongoDB Enterprise &gt; db.blog.remove(&#123;_id:ObjectId(&quot;5b12c86dc4dbabca2ce3b2aa&quot;)&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nRemoved&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c838c4dbabca2ce3b2a9&quot;), &quot;docment&quot; : &quot;welcome to use mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c873c4dbabca2ce3b2ab&quot;), &quot;title&quot; : &quot;my test&quot;, &quot;name&quot; : &quot;pc&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c888c4dbabca2ce3b2ac&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c88bc4dbabca2ce3b2ad&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">blog</span><br><span class="line">## 在当前数据库创建一个指定名称的集合</span><br><span class="line">MongoDB Enterprise &gt; db.createCollection(&quot;course&quot;)</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">blog</span><br><span class="line">course</span><br><span class="line">## 这个shell函数findOne会返回一个文档 而find函数会返回最多二十个文档.更多区别我们在后面详细介绍</span><br><span class="line">MongoDB Enterprise &gt; db.blog.findOne()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;),</span><br><span class="line">        &quot;title1&quot; : &quot;instrduce of mongo&quot;</span><br><span class="line">&#125;</span><br><span class="line">## 统计集合blog所有文档数量</span><br><span class="line">MongoDB Enterprise &gt; db.blog.count()</span><br><span class="line">6</span><br><span class="line">## 退出mongo客户端</span><br><span class="line">MongoDB Enterprise &gt; exit</span><br><span class="line">bye</span><br><span class="line">tst01 mongod&gt;</span><br></pre></td></tr></table></figure>
<h2 id="2-创建-删除数据库"><a href="#2-创建-删除数据库" class="headerlink" title="2. 创建/删除数据库"></a>2. 创建/删除数据库</h2><p>1.创建数据库语法<br>如果数据库不存在，则指向数据库，但不创建（等待实际数据入库时创建），否则切换到指定数据库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use DATABASE_NAME</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; use webdb</span><br><span class="line">switched to db webdb</span><br><span class="line">MongoDB Enterprise &gt; db</span><br><span class="line">webdb</span><br><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">MongoDB Enterprise &gt; db.kemu.insert(&#123;&quot;name&quot;:&quot;python&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.kemu.insert(&#123;&quot;name&quot;:&quot;java&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">kemu</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<p>2.删除数据库语法<br>删除当前数据库，默认为 test，你可以使用 db 命令查看当前数据库名。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">webdb    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; use webdb</span><br><span class="line">switched to db webdb</span><br><span class="line">MongoDB Enterprise &gt; db.dropDatabase()</span><br><span class="line">&#123; &quot;dropped&quot; : &quot;webdb&quot;, &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="3-创建-删除集合"><a href="#3-创建-删除集合" class="headerlink" title="3. 创建/删除集合"></a>3. 创建/删除集合</h2><p>1.创建集合语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(name, options)</span><br></pre></td></tr></table></figure></p>
<p>在命令中, name 是要创建的集合的名称. Options 是一个文档，用于指定配置的集合</p>
<table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:center">类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td style="text-align:center">String</td>
<td>要创建的集合名称</td>
</tr>
<tr>
<td>Options</td>
<td style="text-align:center">Document</td>
<td>（可选）指定有关内存大小和索引选项</td>
</tr>
</tbody>
</table>
<p>选项​​参数是可选的，所以只需要到指定的集合名称。以下是可以使用的选项列表：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th style="text-align:center">类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>capped</td>
<td style="text-align:center">Boolean</td>
<td>（可选）如果为true，则启用封顶集合。封顶集合是固定大小的集合，当它达到其最大大小，会自动覆盖最早的条目。如果指定true，则需要也指定size字段。</td>
</tr>
<tr>
<td>autoIndexID</td>
<td style="text-align:center">Boolean</td>
<td>（可选）如果为true，自动创建索引_id字段, 默认值是false。(对于副本集，不要将AutoReXixID设置为false)</td>
</tr>
<tr>
<td>size</td>
<td style="text-align:center">number</td>
<td>（可选）指定集合最大可使用字节。如果封顶是 true，那么你还需要指定这个字段。</td>
</tr>
<tr>
<td>max</td>
<td style="text-align:center">number</td>
<td>（可选）指定封顶集合允许在文件的最大数量。Size限制优先于此限制。如果一个封顶集合达到大小size限制，未达到文件的最大数量，MongoDB删除旧的文件。如果您更喜欢使用max，确保为上限的集合所需的大小限制，足以包含文档的最大数量</td>
</tr>
</tbody>
</table>
<p>当插入文档，MongoDB 第一检查大小字段封顶集合，然后它会检查最大的字段。</p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; use example</span><br><span class="line">switched to db example</span><br><span class="line">MongoDB Enterprise &gt; db.createCollection(&quot;mycollection&quot;)</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">mycollection</span><br><span class="line">MongoDB Enterprise &gt; db.createCollection(&quot;log&quot;,&#123;capped:true,size:1024,max:2&#125;)</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">log</span><br><span class="line">mycollection</span><br><span class="line">MongoDB Enterprise &gt; db.log.insert(&#123;&quot;info&quot;:&quot;message one&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.log.insert(&#123;&quot;info&quot;:&quot;message two&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.log.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d1471f0853ff9e2fe048&quot;), &quot;info&quot; : &quot;message one&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d14a1f0853ff9e2fe049&quot;), &quot;info&quot; : &quot;message two&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.log.insert(&#123;&quot;info&quot;:&quot;message three&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">## 请注意观察这个值和上面值有何问题</span><br><span class="line">MongoDB Enterprise &gt; db.log.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d14a1f0853ff9e2fe049&quot;), &quot;info&quot; : &quot;message two&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d1581f0853ff9e2fe04a&quot;), &quot;info&quot; : &quot;message three&quot; &#125;</span><br><span class="line">## 在MongoDB中，可以不需要创建集合。当插入一些文档自动创建的集合</span><br><span class="line">MongoDB Enterprise &gt; db.sessionInfo.insert(&#123;&quot;ip&quot;:&quot;192.1.1.1&quot;,&quot;name&quot;:&quot;D98&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.sessionInfo.insert(&#123;&quot;ip&quot;:&quot;192.1.1.2&quot;,&quot;name&quot;:&quot;L98&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">log</span><br><span class="line">mycollection</span><br><span class="line">sessionInfo</span><br><span class="line">MongoDB Enterprise &gt; db.sessionInfo.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d18d1f0853ff9e2fe04b&quot;), &quot;ip&quot; : &quot;192.1.1.1&quot;, &quot;name&quot; : &quot;D98&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d1921f0853ff9e2fe04c&quot;), &quot;ip&quot; : &quot;192.1.1.2&quot;, &quot;name&quot; : &quot;L98&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<p>2.删除集合语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.drop()</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">example  0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; use example</span><br><span class="line">switched to db example</span><br><span class="line">MongoDB Enterprise &gt; db.getCollectionNames()</span><br><span class="line">[ &quot;log&quot;, &quot;mycollection&quot;, &quot;sessionInfo&quot; ]</span><br><span class="line">MongoDB Enterprise &gt; db.log.drop()</span><br><span class="line">true</span><br><span class="line">MongoDB Enterprise &gt; db.getCollectionNames()</span><br><span class="line">[ &quot;mycollection&quot;, &quot;sessionInfo&quot; ]</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="4-数据类型"><a href="#4-数据类型" class="headerlink" title="4. 数据类型"></a>4. 数据类型</h2><p>下表为MongoDB中常用的几种数据类型。</p>
<ul>
<li>String : 这是最常用的数据类型来存储数据。在MongoDB中的字符串必须是有效的UTF-8</li>
<li>Integer : 这种类型是用来存储一个数值。整数可以是32位或64位，这取决于您的服务器</li>
<li>Boolean : 此类型用于存储一个布尔值 (true/ false)</li>
<li>Double : 这种类型是用来存储浮点值</li>
<li>Min/ Max keys : 这种类型被用来对BSON元素的最低和最高值比较</li>
<li>Arrays : 使用此类型的数组或列表或多个值存储到一个键</li>
<li>Timestamp : 时间戳。这可以方便记录时的文件已被修改或添加</li>
<li>Object : 此数据类型用于嵌入式的文件</li>
<li>Null : 这种类型是用来存储一个Null值</li>
<li>Symbol : 此数据类型用于字符串相同，但它通常是保留给特定符号类型的语言使用</li>
<li>Date : 此数据类型用于存储当前日期或时间的UNIX时间格式。可以指定自己的日期和时间，日期和年，月，日到创建对象</li>
<li>Object ID : 此数据类型用于存储文档的ID</li>
<li>Binary data : 此数据类型用于存储二进制数据</li>
<li>Code : 此数据类型用于存储到文档中的JavaScript代码</li>
<li>Regular expression : 此数据类型用于存储正则表达式</li>
</ul>
<h2 id="5-插入文档"><a href="#5-插入文档" class="headerlink" title="5. 插入文档"></a>5. 插入文档</h2><p>要插入数据到 MongoDB 集合，需要使用 MongoDB 的 insert() 或 save() 方法。<br>对应的语法分别如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.insert(document)</span><br><span class="line">db.COLLECTION_NAME.save(document)</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">use example</span><br><span class="line">## 插入文档</span><br><span class="line">db.mycol.insert(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;MongoDB Overview&apos;, </span><br><span class="line">     description: &apos;MongoDB is no sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;mongodb&apos;, &apos;database&apos;, &apos;NoSQL&apos;],</span><br><span class="line">     likes: 100</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db.mycol.insert(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;MySQL Overview&apos;, </span><br><span class="line">     description: &apos;MySQL is sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;MySQL&apos;, &apos;database&apos;, &apos;SQL&apos;],</span><br><span class="line">     likes: 40</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">## 查看并美化显示结果</span><br><span class="line">db.mycol.find().pretty()</span><br><span class="line"></span><br><span class="line">## 要插入单个查询的多个文档，可以传递一个数组 insert() 命令的文件</span><br><span class="line">db.mycol.insert(</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;sqlserver&apos;, </span><br><span class="line">     description: &apos;sqlserver is sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;sqlserver&apos;, &apos;database&apos;, &apos;SQL&apos;],</span><br><span class="line">     likes: 40</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;oracle&apos;, </span><br><span class="line">     description: &apos;oracle is sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;oracle&apos;, &apos;database&apos;, &apos;SQL&apos;],</span><br><span class="line">     likes: 40</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>insert() 或 save()区别<br>1.插入的文档的无_id<br>save() 方法等同于insert()方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.mycolone.insert(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;mongod&apos;, </span><br><span class="line">     description: &apos;mongod is nosql database&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">db.mycolone.save(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;mongod&apos;, </span><br><span class="line">     description: &apos;mongod is nosql database&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>2.插入的文档的带有”_id”<br>如果想插入的数据对象已存在数据集合中,<br>insert函数会报错,提示<code>E11000 duplicate key error collection</code><br>save函数是覆盖原来的对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db.mycoltwo.insert(</span><br><span class="line">&#123;</span><br><span class="line">  _id : 2016001, </span><br><span class="line">  &quot;name&quot; : &quot;guojing&quot;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">db.mycoltwo.save(</span><br><span class="line">&#123;</span><br><span class="line">  _id : 2016001, </span><br><span class="line">  &quot;name&quot; : &quot;guojing&quot;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">db.mycoltwo.insert(</span><br><span class="line">&#123;</span><br><span class="line">  _id : 2016001, </span><br><span class="line">  &quot;name&quot; : &quot;guojing&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="/2018/07/22/MongoDB基础操作/jc_1.png" alt=""></p>
<h2 id="6-查询文档"><a href="#6-查询文档" class="headerlink" title="6. 查询文档"></a>6. 查询文档</h2><h3 id="6-1-基础查询语法"><a href="#6-1-基础查询语法" class="headerlink" title="6.1 基础查询语法"></a>6.1 基础查询语法</h3><p>基本的find()方法语法如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query, projection)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>query ：可选，使用查询操作符指定查询条件</li>
<li>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）</li>
</ul>
<p>如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find().pretty()</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;New MongoDB Tutorial&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB is no sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;bowenz&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MySQL Overview&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MySQL is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;lt50&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;MySQL&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;sqlserver&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;sqlserver is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;lt50&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;sqlserver&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;oracle&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;oracle is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;lt50&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;oracle&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<p>除了find() 方法外，还有一个 findOne() 法，返回一个结果 ,大家可以实战下。</p>
<p><strong>MongoDB 与 RDBMS Where 语句比较</strong></p>
<table>
<thead>
<tr>
<th>操作</th>
<th style="text-align:center">语法</th>
<th>例子</th>
<th>RDBMS 等同</th>
</tr>
</thead>
<tbody>
<tr>
<td>等于</td>
<td style="text-align:center"><code>{&lt;key&gt;:&lt;value&gt;}</code></td>
<td>db.mycol.find({“by”:”tutorials itcast”}).pretty()</td>
<td>where by = ‘tutorials itcast’</td>
</tr>
<tr>
<td>小于</td>
<td style="text-align:center"><code>{&lt;key&gt;:{$lt:&lt;value&gt;}}</code></td>
<td>db.mycol.find({“likes”:{$lt:50}}).pretty()</td>
<td>where likes &lt; 50</td>
</tr>
<tr>
<td>小于或等于</td>
<td style="text-align:center"><code>{&lt;key&gt;:{$lte:&lt;value&gt;}}</code></td>
<td>db.mycol.find({“likes”:{$lte:50}}).pretty()</td>
<td>where likes &lt;= 50</td>
</tr>
<tr>
<td>大于</td>
<td style="text-align:center"><code>{&lt;key&gt;:{$gt:&lt;value&gt;}}</code></td>
<td>db.mycol.find({“likes”:{$gt:50}}).pretty()</td>
<td>where likes &gt; 50</td>
</tr>
<tr>
<td>大于或等于</td>
<td style="text-align:center"><code>{&lt;key&gt;:{$gte:&lt;value&gt;}}</code></td>
<td>db.mycol.find({“likes”:{$gte:50}}).pretty()</td>
<td>where likes &gt;= 50</td>
</tr>
<tr>
<td>不等于</td>
<td style="text-align:center"><code>{&lt;key&gt;:{$ne:&lt;value&gt;}}</code></td>
<td>db.mycol.find({“likes”:{$ne:50}}).pretty()</td>
<td>where likes != 50</td>
</tr>
</tbody>
</table>
<p><strong>AND 在MongoDB中用法</strong><br>MongoDB 的 find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 SQL 的 AND 条件。<br>语法格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find(&#123;key1:value1, key2:value2&#125;).pretty()</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&quot;title&quot;:&quot;oracle&quot;,&quot;by&quot;:&quot;lt50&quot;&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>MongoDB中OR</strong><br>MongoDB OR 条件语句使用了关键字 $or,语法格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find(&#123;$or: [&#123;key1: value1&#125;, &#123;key2:value2&#125;]&#125;).pretty()</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;$or:[&#123;&quot;title&quot;:&quot;oracle&quot;&#125;,&#123;&quot;title&quot;:&quot;New MongoDB Tutorial&quot;&#125;]&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>AND 和 OR 一起使用</strong><br>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&quot;by&quot;:&quot;lt50&quot;,$or:[&#123;&quot;title&quot;:&quot;oracle&quot;&#125;,&#123;&quot;title&quot;:&quot;sqlserver&quot;&#125;]&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p><strong>projection 参数的使用方法</strong><br>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&quot;by&quot;:&quot;lt50&quot;&#125;,&#123;&quot;title&quot;:1,&quot;by&quot;:1&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;by&quot; : &quot;lt50&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;by&quot; : &quot;lt50&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;by&quot; : &quot;lt50&quot; &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="6-2-Limit和Skip"><a href="#6-2-Limit和Skip" class="headerlink" title="6.2 Limit和Skip"></a>6.2 Limit和Skip</h3><p>如果你需要在MongoDB中读取指定数量的数据记录，可以使用MongoDB的Limit方法，limit()方法接受一个数字参数，该参数指定从MongoDB中读取的记录条数。<br>limit()方法基本语法如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().limit(NUMBER)</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find().limit(2)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p>我们除了可以使用limit()方法来读取指定数量的数据外，还可以使用skip()方法来跳过指定数量的数据，skip方法同样接受一个数字参数作为跳过的记录条数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().limit(NUMBER).skip(NUMBER)</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find().skip(2).limit(1)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="6-3-MONGODB排序-distinct"><a href="#6-3-MONGODB排序-distinct" class="headerlink" title="6.3 MONGODB排序/distinct"></a>6.3 MONGODB排序/distinct</h3><p>在MongoDB中使用使用sort()方法对数据进行排序，sort()方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而-1是用于降序排列。<br>sort()方法基本语法如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().sort(&#123;KEY:1&#125;)</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&#125;,&#123;&quot;title&quot;:1,&quot;likes&quot;:1&#125;).sort(&#123;&quot;likes&quot;:1&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;likes&quot; : 100 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&#125;,&#123;&quot;title&quot;:1,&quot;likes&quot;:1&#125;).sort(&#123;&quot;likes&quot;:-1&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p>在MongoDB中使用使用distinct()方法对数据进行去重。<br>distinct方法基本语法如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.distinct(field, query)</span><br></pre></td></tr></table></figure></p>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.distinct(&quot;likes&quot;)</span><br><span class="line">[ 100, 40 ]</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.distinct(&quot;by&quot;)</span><br><span class="line">[ &quot;bowenz&quot;, &quot;lt50&quot; ]</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.distinct(&quot;title&quot;)</span><br><span class="line">[ &quot;New MongoDB Tutorial&quot;, &quot;MySQL Overview&quot;, &quot;sqlserver&quot;, &quot;oracle&quot; ]</span><br></pre></td></tr></table></figure></p>
<h3 id="6-4-MONGODB聚合"><a href="#6-4-MONGODB聚合" class="headerlink" title="6.4 MONGODB聚合"></a>6.4 MONGODB聚合</h3><h4 id="6-4-1-aggregate语法"><a href="#6-4-1-aggregate语法" class="headerlink" title="6.4.1 aggregate语法"></a>6.4.1 aggregate语法</h4><p>MongoDB中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似sql语句中的 count(*), sum(), avg()。</p>
<p>aggregate()语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.mycol.aggregate(</span><br><span class="line">[</span><br><span class="line">  &#123; </span><br><span class="line">    $group:&#123;</span><br><span class="line">		_id:&quot;$by&quot;,</span><br><span class="line">		num_tutorial:&#123;</span><br><span class="line">			$sum:1</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>执行上诉语句得到以下结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;lt50&quot;, &quot;num_tutorial&quot; : 3 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;bowenz&quot;, &quot;num_tutorial&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<p>在上面的例子中，我们通过字段by字段对数据进行分组，并计算by字段相同值的总和。<br>下表展示了一些聚合的表达式:</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th style="text-align:center">描述</th>
<th>实例</th>
</tr>
</thead>
<tbody>
<tr>
<td>$sum</td>
<td style="text-align:center">计算总和</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$sum : “$likes”}}}])</td>
</tr>
<tr>
<td>$avg</td>
<td style="text-align:center">计算平均值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$avg : “$likes”}}}])</td>
</tr>
<tr>
<td>$min</td>
<td style="text-align:center">获取集合中所有文档对应值得最小值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$min : “$likes”}}}])</td>
</tr>
<tr>
<td>$max</td>
<td style="text-align:center">获取集合中所有文档对应值得最大值</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$max : “$likes”}}}])</td>
</tr>
<tr>
<td>$push</td>
<td style="text-align:center">在结果文档中插入值到一个数组中</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, url : {$push: “$url”}}}])</td>
</tr>
<tr>
<td>$addToSet</td>
<td style="text-align:center">在结果文档中插入值到一个数组中，但不创建副本</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, url : {$addToSet : “$url”}}}])</td>
</tr>
<tr>
<td>$first</td>
<td style="text-align:center">根据资源文档的排序获取第一个文档数据</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, first_url : {$first : “$url”}}}])</td>
</tr>
<tr>
<td>$last</td>
<td style="text-align:center">根据资源文档的排序获取最后一个文档数据</td>
<td>db.mycol.aggregate([{$group : {_id : “$by”, last_url : {$last : “$url”}}}])</td>
</tr>
</tbody>
</table>
<p>以下语句的含义呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.mycol.aggregate([&#123;$group : &#123;_id : &#123;by:&quot;$by&quot;,url:&quot;$url&quot;&#125;, num_tutorial : &#123;$sum : &quot;$likes&quot;&#125;&#125;&#125;])</span><br></pre></td></tr></table></figure></p>
<h4 id="6-4-2-管道"><a href="#6-4-2-管道" class="headerlink" title="6.4.2 管道"></a>6.4.2 管道</h4><p>管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的输入。如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@tst01 ~]# ll</span><br><span class="line">total 104</span><br><span class="line">-rw-------. 1 root root  1554 May 30 21:20 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Desktop</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Documents</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Downloads</span><br><span class="line">-rw-r--r--. 1 root root 51788 May 30 21:20 install.log</span><br><span class="line">-rw-r--r--. 1 root root 10033 May 30 21:17 install.log.syslog</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Music</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Pictures</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Public</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Templates</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Videos</span><br><span class="line">[root@tst01 ~]# ll | grep Des</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Desktop</span><br></pre></td></tr></table></figure></p>
<p>MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。<br>表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。<br>聚合管道示意图：<br><img src="/2018/07/22/MongoDB基础操作/jc_2.png" alt=""></p>
<p>相当于Sql语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Select cust_id,sum(amount)as total from orders where status= &quot;A&quot; group by cust_id</span><br></pre></td></tr></table></figure></p>
<p>这里我们介绍一下聚合框架中常用的几个操作：</p>
<ul>
<li>$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</li>
<li>$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。</li>
<li>$limit：用来限制MongoDB聚合管道返回的文档数。</li>
<li>$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。</li>
<li>$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</li>
<li>$group：将集合中的文档分组，可用于统计结果。</li>
<li>$sort：将输入文档排序后输出。</li>
<li>$lookup :joined集合中的匹配文档。</li>
</ul>
<h5 id="6-4-2-1-project"><a href="#6-4-2-1-project" class="headerlink" title="6.4.2.1 $project"></a>6.4.2.1 $project</h5><p>修改输入文档的结构。可以用来重命名、增加或删除字段(域)，也可以用于创建计算结果以及嵌套文档。<br>思考，现有books集合内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">db.books.insert(</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">  title: &quot;mongodb course&quot;,</span><br><span class="line">  isbn: &quot;0001122223334&quot;,</span><br><span class="line">  author: &#123; last: &quot;bowen&quot;, first: &quot;zhuang&quot; &#125;,</span><br><span class="line">  copies: 5</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  title: &quot;mysql course&quot;,</span><br><span class="line">  isbn: &quot;0001122223334&quot;,</span><br><span class="line">  author: &#123; last: &quot;bowen&quot;, first: &quot;zhuang&quot; &#125;,</span><br><span class="line">  copies: 6</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>指定输出字段</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( [ &#123; $project: &#123; title: 1, author: 1 &#125; &#125; ] )</span><br><span class="line">db.books.aggregate( &#123; $project: &#123; _id: 0, title: 1, author: 1 &#125; &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>输出嵌入式文档中field</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( &#123; $project: &#123; _id: 0, title: 1, &quot;author.last&quot;: 1 &#125; &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>改变输出结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( &#123; $project: &#123; _id: 0, title: 1, &quot;lastName&quot;: &quot;$author.last&quot; &#125; &#125;)</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算 Fields<br>substr 语法： <code>{ $substr: [ &lt;string&gt;, &lt;start&gt;, &lt;length&gt; ] }</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( [ &#123; $project: &#123; title: 1, isbn: &#123;</span><br><span class="line">prefix: &#123; $substr: [ &quot;$isbn&quot;, 1, 3 ] &#125;, &#125;, </span><br><span class="line">lastName: &quot;$author.last&quot;, copiesSold: &quot;$copies&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="6-4-2-2-match"><a href="#6-4-2-2-match" class="headerlink" title="6.4.2.2 $match"></a>6.4.2.2 $match</h5><p>用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。<br>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.articles.insert([ &#123; &quot;_id&quot; : 1, &quot;author&quot; : &quot;dave&quot;, &quot;score&quot; : 80, &quot;views&quot; : 100 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;author&quot; : &quot;dave&quot;, &quot;score&quot; : 85, &quot;views&quot; : 521 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;author&quot; : &quot;ahn&quot;, &quot;score&quot; : 60, &quot;views&quot; : 1000 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;author&quot; : &quot;li&quot;, &quot;score&quot; : 55, &quot;views&quot; : 5000 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;author&quot; : &quot;annT&quot;, &quot;score&quot; : 60, &quot;views&quot; : 50 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 6, &quot;author&quot; : &quot;li&quot;, &quot;score&quot; : 94, &quot;views&quot; : 999 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 7, &quot;author&quot; : &quot;ty&quot;, &quot;score&quot; : 95, &quot;views&quot; : 1000 &#125; ])</span><br></pre></td></tr></table></figure></p>
<ol>
<li><p>Match 匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate([ &#123; $match : &#123; author : &quot;dave&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure>
</li>
<li><p>范围条件匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate([ &#123; $match: &#123; $or: [ &#123; score: &#123; $gt: 70, $lt: 90 &#125; &#125;, &#123; views: &#123; $gte: 1000 &#125; &#125; ] &#125; &#125; ])</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算Count值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate( [ &#123; $match: &#123; $or: [ &#123; score: &#123; $gt: 70, $lt: 90 &#125; &#125;, </span><br><span class="line">&#123; views: &#123; $gte: 1000 &#125; &#125; ] &#125; &#125;, </span><br><span class="line">&#123; $group: &#123; _id: null, count: &#123; $sum: 1 &#125; &#125; &#125; ] )</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h5 id="6-4-2-3-group"><a href="#6-4-2-3-group" class="headerlink" title="6.4.2.3 $group"></a>6.4.2.3 $group</h5><p>将集合中的文档分组，可用于统计结果。<br>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.sales.insert([ &#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : 10, &quot;quantity&quot; : 2, &quot;date&quot; : ISODate(&quot;2014-03-01T08:00:00Z&quot;) &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;jkl&quot;, &quot;price&quot; : 20, &quot;quantity&quot; : 1, &quot;date&quot; : ISODate(&quot;2014-03-01T09:00:00Z&quot;) &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;xyz&quot;, &quot;price&quot; : 5, &quot;quantity&quot; : 10, &quot;date&quot; : ISODate(&quot;2014-03-15T09:00:00Z&quot;) &#125;, &#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;xyz&quot;, &quot;price&quot; : 5, &quot;quantity&quot; : 20, &quot;date&quot; : ISODate(&quot;2014-04-04T11:21:39.736Z&quot;) &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : 10, &quot;quantity&quot; : 10, &quot;date&quot; : ISODate(&quot;2014-04-04T21:23:13.331Z&quot;) &#125; ])</span><br></pre></td></tr></table></figure></p>
<p>下面的聚合操作使用 $group 将文档按月、日、年组分组, 计算平均数量以及每个组的文档数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate(</span><br><span class="line">   [</span><br><span class="line">      &#123;</span><br><span class="line">        $group : &#123;</span><br><span class="line">           _id : &#123; month: &#123; $month: &quot;$date&quot; &#125;, day: &#123; $dayOfMonth: &quot;$date&quot; &#125;, year: &#123; $year: &quot;$date&quot; &#125; &#125;,</span><br><span class="line">           averageQuantity: &#123; $avg: &quot;$quantity&quot; &#125;,</span><br><span class="line">           count: &#123; $sum: 1 &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>下面的聚合操作指定_id 等于null的空组，计算总价格和平均数量以及集合中的所有文件数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate(</span><br><span class="line">   [</span><br><span class="line">      &#123;</span><br><span class="line">        $group : &#123;</span><br><span class="line">           _id : null,</span><br><span class="line">           totalPrice: &#123; $sum: &#123; $multiply: [ &quot;$price&quot;, &quot;$quantity&quot; ] &#125; &#125;,</span><br><span class="line">           averageQuantity: &#123; $avg: &quot;$quantity&quot; &#125;,</span><br><span class="line">           count: &#123; $sum: 1 &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>下面的聚合操作使用 $group 将item字段去重，以检索不同的项目值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate( [ &#123; $group : &#123; _id : &quot;$item&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure></p>
<p>集合$match,做个复杂的聚合运算<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate(</span><br><span class="line">[</span><br><span class="line">  &#123;$match: &#123;$or: [&#123;views:&#123;$gte:1000&#125;&#125;,&#123;score:&#123;$gt:70,$lt:90&#125;&#125;]&#125; &#125;,</span><br><span class="line">  &#123;$group: &#123;_id:&quot;$author&quot;,sum_score:&#123;$sum: &quot;$score&quot;&#125;,avg_views:&#123;$avg:&quot;$views&quot;&#125;&#125;&#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<h5 id="6-4-2-4-unwind"><a href="#6-4-2-4-unwind" class="headerlink" title="6.4.2.4 $unwind"></a>6.4.2.4 $unwind</h5><p>将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值<br>语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $unwind:</span><br><span class="line">    &#123;</span><br><span class="line">      path: &lt;field path&gt;,          #拆分路径</span><br><span class="line">      includeArrayIndex: &lt;string&gt;,   #指定数组索引号</span><br><span class="line">      preserveNullAndEmptyArrays: &lt;boolean&gt;   #防止数据丢失</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.shoes.insert([ &#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;sizes&quot;: [ &quot;S&quot;, &quot;M&quot;, &quot;L&quot;] &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;EFG&quot;, &quot;sizes&quot; : [ ] &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;IJK&quot;, &quot;sizes&quot;: &quot;M&quot; &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;LMN&quot; &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;XYZ&quot;, &quot;sizes&quot; : null &#125; ])</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.shoes.aggregate( [ &#123; $unwind: &quot;$sizes&quot; &#125; ] )</span><br><span class="line">db.shoes.aggregate( [ &#123; $unwind: &#123; path: &quot;$sizes&quot; &#125; &#125; ] )</span><br><span class="line">db.shoes.aggregate( [ &#123; $unwind: &#123; path: &quot;$sizes&quot;,preserveNullAndEmptyArrays:true&#125; &#125; ] )</span><br><span class="line">db.shoes.aggregate( [ &#123; $unwind: &#123; path: &quot;$sizes&quot;, includeArrayIndex: &quot;arrayIndex&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure>
<h5 id="6-4-2-4-lookup"><a href="#6-4-2-4-lookup" class="headerlink" title="6.4.2.4 $lookup"></a>6.4.2.4 $lookup</h5><p>执行左连接到一个集合(unsharded)，必须在同一数据库中<br>$lookup添加了一个新的数组字段，该字段的元素是joined集合中的匹配文档。</p>
<p>$lookup 语法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   $lookup:</span><br><span class="line">     &#123;</span><br><span class="line">       from: &lt;collection to join&gt;,   #右集合</span><br><span class="line">       localField: &lt;field from the input documents&gt;,  #左集合 join字段</span><br><span class="line">       foreignField: &lt;field from the documents of the &quot;from&quot; collection&gt;, #右集合 join字段</span><br><span class="line">       as: &lt;output array field&gt;   #新生成字段（类型array）</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<table>
<thead>
<tr>
<th>Field</th>
<th style="text-align:center">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>from</td>
<td style="text-align:center">右集合，指定在同一数据库中执行连接的集合。此集合不能shared分片</td>
</tr>
<tr>
<td>localField</td>
<td style="text-align:center">指定左集合（db.collectionname）匹配的字段。如果左集合不包含localField，$lookup 视为null值来匹配</td>
</tr>
<tr>
<td>foreignField</td>
<td style="text-align:center">指定from集合（右集合）用来匹配的字段。如果集合不包含该字段，$lookup 视为null值来匹配</td>
</tr>
<tr>
<td>as</td>
<td style="text-align:center">指定要添加到输入文档的新数组字段的名称。新的数组字段包含from集合中匹配的文档。如果在文档中指定的名称已经存在，现有的领域覆盖</td>
</tr>
</tbody>
</table>
<p>实例<br><strong>使用$lookup集合连接</strong><br>左集合 <code>orders</code> 内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.orders.insert([ &#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : 12, &quot;quantity&quot; : 2 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;jkl&quot;, &quot;price&quot; : 20, &quot;quantity&quot; : 1 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3 &#125; ])</span><br></pre></td></tr></table></figure></p>
<p>另外一个右集合 <code>products</code> 内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.products.insert([ &#123; &quot;_id&quot; : 1, &quot;sku&quot; : &quot;abc&quot;, description: &quot;product 1&quot;, &quot;instock&quot; : 120 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;sku&quot; : &quot;def&quot;, description: &quot;product 2&quot;, &quot;instock&quot; : 80 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;sku&quot; : &quot;ijk&quot;, description: &quot;product 3&quot;, &quot;instock&quot; : 60 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;sku&quot; : &quot;jkl&quot;, description: &quot;product 4&quot;, &quot;instock&quot; : 70 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;sku&quot;: null, description: &quot;Incomplete&quot; &#125;, &#123; &quot;_id&quot; : 6 &#125; ])</span><br></pre></td></tr></table></figure></p>
<p>以下聚合操作对 <code>orders</code>左集合 左连接 <code>products</code> 右集合，通过 <code>orders</code>下的<code>item</code> 与 <code>products</code> 集合的<code>sku</code>：<br>值得注意：</p>
<ul>
<li>两个集合必须在同一个db</li>
<li>orders是左集合，左连接</li>
<li>item是orders左集合字段</li>
<li>sku是products右集合字段</li>
<li>item为null, 左连接, 右集合 sku为null</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.orders.aggregate([ &#123; $lookup: &#123; from: &quot;products&quot;, localField: &quot;item&quot;, foreignField: &quot;sku&quot;, as: &quot;product_docs&quot; &#125; &#125; ]).pretty()</span><br></pre></td></tr></table></figure>
<h5 id="6-4-2-4-out"><a href="#6-4-2-4-out" class="headerlink" title="6.4.2.4 $out"></a>6.4.2.4 $out</h5><p>输出到集合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.orders.aggregate([ &#123; $lookup: &#123; from: &quot;products&quot;, localField: &quot;item&quot;, foreignField: &quot;sku&quot;, as: &quot;product_docs&quot; &#125; &#125;,</span><br><span class="line">&#123; $out : &quot;order_details&quot; &#125;</span><br><span class="line"> ])</span><br><span class="line">db.order_details.find()</span><br></pre></td></tr></table></figure></p>
<h2 id="7-更新-删除文档"><a href="#7-更新-删除文档" class="headerlink" title="7. 更新/删除文档"></a>7. 更新/删除文档</h2><p>MongoDB 使用 update() 和 save() 方法来更新集合中的文档。接下来让我们详细来看下两个函数的应用及其区别。<br>update() 方法的基本语法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p>
<p>参数说明：</p>
<ul>
<li>query : update的查询条件，类似sql update查询内where后面的</li>
<li>update : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的</li>
<li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew，true为插入，默认是false，不插入</li>
<li>multi : 可选，mongodb 默认是false，只更新找到的第一条记录，如果这个参数为true，就把按条件查出来多条记录全部更新</li>
<li>writeConcern :可选，抛出异常的级别</li>
</ul>
<p>实例<br>考虑用以下数据集合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; use example</span><br><span class="line">switched to db example</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">mycol</span><br><span class="line">mycollection</span><br><span class="line">mycolone</span><br><span class="line">mycoltwo</span><br><span class="line">sessionInfo</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MongoDB Overview&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB is no sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MySQL Overview&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MySQL is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;MySQL&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;sqlserver&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;sqlserver is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;sqlserver&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;oracle&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;oracle is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;oracle&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<p>下面的例子将设置标题MongoDB Overview的文件，更新其标题是New MongoDB Tutorial<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.update(&#123;&quot;title&quot;:&quot;MongoDB Overview&quot;&#125;,&#123;$set:&#123;&quot;title&quot;:&quot;New MongoDB Tutorial&quot;&#125;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p>MongoDB默认将只更新单一的文件，来更新多个你需要设置参数置multi为true<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.update(&#123;&quot;by&quot;:&quot;tutorials itcast&quot;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;bowenz&quot;&#125;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.update(&#123;&quot;by&quot;:&quot;tutorials itcast&quot;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;bowenz&quot;&#125;&#125;,&#123;multi:true&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 3, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 3 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p>
<p>save() 方法覆盖原有的文档 或者 插入新的文档，我们在<code>插入文档</code>部分已介绍，在此不在重复.</p>
<p><strong>在3.2版本开始，MongoDB提供以下更新集合文档的方法：</strong></p>
<ul>
<li>db.collection.updateOne() 向指定集合更新单个文档</li>
<li>db.collection.updateMany() 向指定集合更新多个文档</li>
</ul>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># updateOne</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.updateOne(&#123;&quot;likes&quot;:&#123;$lt:50&#125;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;lt50&quot;&#125;&#125;)</span><br><span class="line">&#123; &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 1, &quot;modifiedCount&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line"></span><br><span class="line"># updateMany</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.updateMany(&#123;&quot;likes&quot;:&#123;$lt:50&#125;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;lt50&quot;&#125;&#125;)</span><br><span class="line">&#123; &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 3, &quot;modifiedCount&quot; : 2 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="8-索引"><a href="#8-索引" class="headerlink" title="8. 索引"></a>8. 索引</h2><p>索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文档并选取那些符合查询条件的记录。<br>这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。<br>索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构</p>
<p>语法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(&#123;keys:1&#125;, options)</span><br></pre></td></tr></table></figure></p>
<p>语法中 Keys 值为你要创建的索引字段，1为指定按升序创建索引，-1即为降序。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:center">类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>keys</td>
<td style="text-align:center">document</td>
<td>创建索引的字段</td>
</tr>
<tr>
<td>Options</td>
<td style="text-align:center">document</td>
<td>可选的。 包含一组控制索引创建的选项的文档。 详细信息请参阅选项。</td>
</tr>
</tbody>
</table>
<p>选项​​参数是可选的,以下是可以使用的选项列表：</p>
<table>
<thead>
<tr>
<th>字段</th>
<th style="text-align:center">类型</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>background</td>
<td style="text-align:center">Boolean</td>
<td>可选的。 在后台构建索引，以便操作不会阻止其他数据库活动。 指定true以在后台构建。 默认值是false</td>
</tr>
<tr>
<td>unique</td>
<td style="text-align:center">Boolean</td>
<td>（可选）为true时，创建唯一索引</td>
</tr>
<tr>
<td>name</td>
<td style="text-align:center">string</td>
<td>（可选）索引的名称</td>
</tr>
<tr>
<td>partialFilterExpression</td>
<td style="text-align:center">document</td>
<td>可选的。 如果指定，则索引仅引用与过滤器表达式匹配的文档。 有关更多信息，有兴趣的可以参考<a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/" target="_blank" rel="noopener">mongodb document index</a></td>
</tr>
<tr>
<td>sparse</td>
<td style="text-align:center">Boolean</td>
<td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false.</td>
</tr>
<tr>
<td>expireAfterSeconds</td>
<td style="text-align:center">integer</td>
<td>指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间</td>
</tr>
<tr>
<td>storageEngine</td>
<td style="text-align:center">document</td>
<td>可选的。 允许用户在创建索引时按每个索引配置存储引擎。</td>
</tr>
</tbody>
</table>
<p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">## 插入数据</span><br><span class="line">db.inventory.insert([</span><br><span class="line">&#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;f1&quot;, type: &quot;food&quot;, quantity: 500 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;f2&quot;, type: &quot;food&quot;, quantity: 100 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;p1&quot;, type: &quot;paper&quot;, quantity: 200 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;p2&quot;, type: &quot;paper&quot;, quantity: 150 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;f3&quot;, type: &quot;food&quot;, quantity: 300 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 6, &quot;item&quot; : &quot;t1&quot;, type: &quot;toys&quot;, quantity: 500 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 7, &quot;item&quot; : &quot;a1&quot;, type: &quot;apparel&quot;, quantity: 250 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 8, &quot;item&quot; : &quot;a2&quot;, type: &quot;apparel&quot;, quantity: 400 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 9, &quot;item&quot; : &quot;t2&quot;, type: &quot;toys&quot;, quantity: 50 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 10, &quot;item&quot; : &quot;f4&quot;, type: &quot;food&quot;, quantity: 75 &#125;])</span><br><span class="line">## 创建索引</span><br><span class="line">db.inventory.createIndex(&#123; quantity: 1&#125;)</span><br><span class="line">## 获取集合inventory的所有索引</span><br><span class="line">db.inventory.getIndexes()</span><br><span class="line">## 删除索引；通过getIndexes获取index的名称</span><br><span class="line">db.inventory.dropIndex(&quot;quantity_1&quot;)</span><br></pre></td></tr></table></figure></p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.0" async></script><a class="article-share-link" data-url="http://BowenZhuangOutlook.github.io/2018/07/22/MongoDB基础操作/" data-id="cjk0h2nyl000s2s7a200b014k" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACt0lEQVR42u3awY7bMAwE0P7/T2+BoodenMyQUnZRPJ8Wier4qYBJDPXrV3x9/blef/vvmmT9079N7n/4wsPDwxs9+tOVr3l9zyd2crfXm/LmDnh4eHjXeJvXd14S2qKSb9Pj53h4eHjfyssb6LwYtI01Hh4e3v/Hy1vztqjg4eHh/TRe8lhJtJoHFvndPpS14OHh4XW5azEA+wl/X5zv4eHh4S2m6q9fuPmobNMiz57z793w8PDwLvA2Q6ZZOHuq1S5W4uHh4V3jtRFtuzV58Do7yPX463h4eHhHecUYaRTg3j6C8ObX8fDw8K7x2ld/HjTkY7NZi//mvwcPDw/vI7yzI7HNsC0PIA7cCA8PD2/Ey1vkWQM9a6nbkvNYGPDw8PAO8ZKfzIf3bex7DPC6YODh4eEd5SXhwiwU2GxBW1TelAQ8PDy8C7yctHms9pDWJoyI5nt4eHh4I17ywp0FBPtik68fninDw8PDG/HaEDYZfW2ijWSGVcTKeHh4eBd4m4FWWzzytnj/K3h4eHjfxcuLxCaqaA91JSvx8PDwvotXjJriWHbWxLdPiIeHh3eP147z20HUbKjWHsaK5nt4eHh4h3htYJqHqqca5bYpf/wWDw8P7xAvaZHzlac+30TAxV7i4eHhzXvd4bHRdjva++xjZTw8PLwbvFlom7zWZ5s1O571JsbFw8PDu8Zry8PmMEHeyrdP8ljx8PDw8A7x2ldw2/jmIUJbSHI8Hh4e3lneV3m1I//25FceFkelBQ8PD+8CbzZqykOK5JP9QK49lICHh4e3/3ZTDPJ4tx1lbVptPDw8vM/wPlMM9gcU2nKCh4eH9728GfJ1qcjj3TYOxsPDw/s5vFnA2m5N26Y/rsfDw8O7xjt1AGvTHO8D3ANZCx4eHt7l2frmMEF7OmxzzAsPDw/vEO83DQTuA7xy3MwAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/MongoDB/">MongoDB</a></div><div class="post-nav"><a class="pre" href="/2018/07/22/Linux基础知识/">Linux基础知识</a><a class="next" href="/2018/07/21/DB思维导图/">DB思维导图</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/博客/">博客</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/技术/">技术</a><span class="category-list-count">4</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/DB/" style="font-size: 15px;">DB</a> <a href="/tags/思维导图/" style="font-size: 15px;">思维导图</a> <a href="/tags/Hexo/" style="font-size: 15px;">Hexo</a> <a href="/tags/博客/" style="font-size: 15px;">博客</a> <a href="/tags/Github/" style="font-size: 15px;">Github</a> <a href="/tags/OGG/" style="font-size: 15px;">OGG</a> <a href="/tags/GoldenGate/" style="font-size: 15px;">GoldenGate</a> <a href="/tags/Linux/" style="font-size: 15px;">Linux</a> <a href="/tags/MongoDB/" style="font-size: 15px;">MongoDB</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/07/22/Linux基础知识/">Linux基础知识</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/22/MongoDB基础操作/">MongoDB基础操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/21/DB思维导图/">DB思维导图</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/19/OGGBG/">GoldenGate Big Data 实验</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/18/Hexo博客搭建/">Hexo博客搭建</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://www.haomwei.com/" title="屠夫" target="_blank">屠夫</a><ul></ul><a href="http://www.timedifferent.com/" title="时光疯子" target="_blank">时光疯子</a><ul></ul><a href="http://BowenZhuangOutlook.github.io" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">尚武.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.3.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>