<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title>Linux基础知识</title>
      <link href="/2018/07/22/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
      <url>/2018/07/22/Linux%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
      <content type="html"><![CDATA[<h1 id="Linux基础课"><a href="#Linux基础课" class="headerlink" title="Linux基础课"></a>Linux基础课</h1><hr><h2 id="1-Linux-文件系统"><a href="#1-Linux-文件系统" class="headerlink" title="1. Linux 文件系统"></a>1. Linux 文件系统</h2><h3 id="1-1-Linux-文件系统概述"><a href="#1-1-Linux-文件系统概述" class="headerlink" title="1.1 Linux 文件系统概述"></a>1.1 Linux 文件系统概述</h3><p>Linux 区别于windows的其中一个很大特点是Linux采用的文件系统结构。<br>即Linux 只有一个单独的顶级目录结构。所有一切都从’root’开始，用’/‘代表，并且延伸到子目录。<br><code>一句话：一切皆文件！当有新的设备要接入Linux，它就把这个设备当作文件目录挂载进来。</code><br>虽然Linux有各种各样不同的发行版本，但他们的文件系统结构大致都是相同的，因此理解了Linux的文件系统结构对学习Linux有非常大的帮助。</p><h3 id="1-2-文件结构"><a href="#1-2-文件结构" class="headerlink" title="1.2 文件结构"></a>1.2 文件结构</h3><ul><li>Linux 文件结构如图所示</li></ul><p><img src="/2018/07/22/Linux基础知识/os_file_system.png" alt=""></p><p><code>/</code> 这是Linux的根，所有文件、设备都是在这个根下<br><code>/bin</code> 这是Linux系统放置很多执行文件的目录，最常见的应该就是<code>/bin/bash</code>是放置<code>shell</code>命令的<br><code>/dev</code> 任何设备与接口设备都是以文件形式存放在这个目录中<br><code>/etc</code> 系统配置文件之类的，比如默认的开机启动项在<code>/etc/init.d/</code>下，还有网络<code>ip</code>地址设置等等<br><code>/lib</code> 放置系统开始时需要用到的函数库，可以想象成<code>windows</code>中的驱动程序<br><code>/sbin</code> 这里面放置是的只有<code>root</code>用户才能使用的执行文件，就是<code>super bin</code>的意思<br><code>/lost+found</code> 这是在标准的<code>ext2/ext3</code>文件系统格式才有的，虽然现在大部分都是<code>ext4</code>了，但我觉得很多企业应该还是使用比较老的文件系统格式，毕竟升级还是有一定危险性，所以还是得了解下。就是当系统发生错误的时候，将一些丢失的片段放在里面<br><code>/usr</code> 特别注意<code>usr</code>是<code>UNIX Software Resource</code>的缩写，不是<code>user</code>，所以里面放的是系统默认的软件，有点像<code>windows</code>里的<code>C:\Windows\</code>和<code>C:\Program files\</code>这两个目录的集合。<br><code>/var</code> 里面主要是系统缓存、登录文件还有软件运行产生的文件等<br><code>/home</code> 这是图中没提到的，当你创建一般用户的时候就会在这个目录下新建一个用户目录<br><code>/media</code> 这里就是放置一些可删除设备，比如<code>U盘</code>、<code>DVD光盘</code>等</p><h3 id="1-3-相对路径和绝对路径"><a href="#1-3-相对路径和绝对路径" class="headerlink" title="1.3 相对路径和绝对路径"></a>1.3 相对路径和绝对路径</h3><ul><li><p>绝对路径<br>是由根目录<code>/</code>开始写起的文件名或目录名称，如 <code>cd /home/oracle/</code></p></li><li><p>相对路径<br>是以你当前所在路径的相对位置来表示，通常以 <code>./</code> 或 <code>../</code> 其中<br><code>.</code>：代表当前的目录<br><code>..</code>：代表上一层目录，即先返回上一层目录，再找到某某文件夹</p></li></ul><h2 id="2-Linux-常用命令"><a href="#2-Linux-常用命令" class="headerlink" title="2. Linux 常用命令"></a>2. Linux 常用命令</h2><h3 id="2-0-Linux-echo命令-必须掌握"><a href="#2-0-Linux-echo命令-必须掌握" class="headerlink" title="2.0 Linux echo命令(必须掌握)"></a>2.0 Linux echo命令(必须掌握)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">功能说明：显示文字。</span><br><span class="line">语 　 法：echo [-ne][字符串] 或 echo [--help][--version]</span><br><span class="line">补充说明：echo 会将输入的字符串送往标准输出。输出的字符串间以空白字符隔开, 并在最后加上换行号。</span><br><span class="line">参　　 数：-n 不要在最后自动换行</span><br><span class="line">-e 若字符串中出现以下字符，则特别加以处理，而不会将它当成一般</span><br><span class="line">文字输出：</span><br><span class="line">   \a 发出警告声；</span><br><span class="line">   \b 删除前一个字符；</span><br><span class="line">   \c 最后不加上换行符号；</span><br><span class="line">   \f 换行但光标仍旧停留在原来的位置；</span><br><span class="line">   \n 换行且光标移至行首；</span><br><span class="line">   \r 光标移至行首，但不换行；</span><br><span class="line">   \t 插入tab；</span><br><span class="line">   \v 与\f相同；</span><br><span class="line">   \\ 插入\字符；</span><br><span class="line">   \nnn 插入nnn（八进制）所代表的ASCII字符；</span><br><span class="line">–help 显示帮助</span><br><span class="line">–version 显示版本信息</span><br></pre></td></tr></table></figure><p><strong>Example</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@sjtscratedb01etc]#echo &quot;this is echo command test&quot;</span><br><span class="line">this is echo command test</span><br><span class="line">[root@sjtscratedb01etc]#</span><br><span class="line"></span><br><span class="line">[root@sjtscratedb01etc]#echo -n &quot;Tecmint is a community of Linux Nerds&quot;</span><br><span class="line">Tecmint is a community of Linux Nerds[root@sjtscratedb01etc]#</span><br><span class="line"></span><br><span class="line">[root@sjtscratedb01etc]#echo  &quot;this is echo \n command test&quot;</span><br><span class="line">this is echo \n command test</span><br><span class="line">[root@sjtscratedb01etc]#</span><br><span class="line"></span><br><span class="line">[root@sjtscratedb01etc]#echo -e &quot;this is echo \n command test&quot;</span><br><span class="line">this is echo </span><br><span class="line"> command test</span><br><span class="line">[root@sjtscratedb01etc]#</span><br></pre></td></tr></table></figure></p><h3 id="2-1-Linux-环境变量-必须掌握"><a href="#2-1-Linux-环境变量-必须掌握" class="headerlink" title="2.1. Linux 环境变量(必须掌握)"></a>2.1. Linux 环境变量(必须掌握)</h3><h4 id="2-1-1-设置环境变量"><a href="#2-1-1-设置环境变量" class="headerlink" title="2.1.1 设置环境变量"></a>2.1.1 设置环境变量</h4><ul><li>暂时性设置环境变量</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">更改PATH环境变量</span><br><span class="line">export PATH=$PATH:/usr/local/MATLAB/R2013b/bin</span><br></pre></td></tr></table></figure><ul><li>永久性设置环境变量</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">如果想要环境变量永久生效可以修改下面两个文件中的任何一个</span><br><span class="line">1 /etc/profile </span><br><span class="line">2 ~/.bash_profile</span><br><span class="line">其中，/etc/profile是全局的环境变量，对所有用户生效，而.bash_profile只对当前用户启作用</span><br><span class="line"></span><br><span class="line">例如：编辑/etc/profile文件，添加CLASSPATH变量 </span><br><span class="line"># vi /etc/profile </span><br><span class="line">export CLASSPATH=./$JAVA_HOME/lib;$JAVA_HOME/jre/lib</span><br><span class="line">注：修改文件后要想马上生效还要运行# source /etc/profile不然只能在下次重进此用户时生效</span><br><span class="line"></span><br><span class="line">例如：编辑oracle用户目录(/home/oracle)下的.bash_profile </span><br><span class="line">$ vi /home/oracle/.bash.profile </span><br><span class="line">添加如下内容： </span><br><span class="line">export CLASSPATH=./$JAVA_HOME/lib;$JAVA_HOME/jre/lib </span><br><span class="line">注：修改文件后要想马上生效还要运行$ source /home/oracle/.bash_profile不然只能在下次重进此用户时生效</span><br></pre></td></tr></table></figure><h4 id="2-1-2-查看环境变量"><a href="#2-1-2-查看环境变量" class="headerlink" title="2.1.2 查看环境变量"></a>2.1.2 查看环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1 使用echo命令查看单个环境变量。例如： </span><br><span class="line">echo $PATH </span><br><span class="line">2 使用env查看所有环境变量。例如： </span><br><span class="line">env </span><br><span class="line">3 使用set查看所有本地定义的环境变量。</span><br></pre></td></tr></table></figure><h4 id="2-1-3-使用unset删除指定环境变量"><a href="#2-1-3-使用unset删除指定环境变量" class="headerlink" title="2.1.3 使用unset删除指定环境变量"></a>2.1.3 使用unset删除指定环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">set可以设置某个环境变量的值。清除环境变量的值用unset命令。如果未指定值，则该变量值将被设为NULL。示例如下： </span><br><span class="line">$ export TEST=&quot;Test...&quot; #增加一个环境变量TEST </span><br><span class="line">$ env|grep TEST #此命令有输入，证明环境变量TEST已经存在了 </span><br><span class="line">TEST=Test... </span><br><span class="line">unset  TEST #删除环境变量TEST </span><br><span class="line">$ env|grep TEST #此命令没有输出，证明环境变量TEST已经删除</span><br></pre></td></tr></table></figure><h4 id="2-1-4-常用的环境变量"><a href="#2-1-4-常用的环境变量" class="headerlink" title="2.1.4 常用的环境变量"></a>2.1.4 常用的环境变量</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">PATH决定了shell将到哪些目录中寻找命令或程序 </span><br><span class="line">HOME 当前用户主目录 </span><br><span class="line">HISTSIZE　历史记录数 </span><br><span class="line">LOGNAME 当前用户的登录名 </span><br><span class="line">HOSTNAME　指主机的名称 </span><br><span class="line">SHELL 当前用户Shell类型 </span><br><span class="line">LANGUGE 　语言相关的环境变量，多语言可以修改此环境变量 </span><br><span class="line">MAIL　当前用户的邮件存放目录 </span><br><span class="line">PS1基本提示符，对于root用户是#，对于普通用户是$</span><br><span class="line">ORACLE_BASE         Oracle数据库基础目录</span><br><span class="line">ORACLE_HOME         Oracle数据库软件的安装目录</span><br><span class="line">ORACLE_SID          Oracle实例名称</span><br><span class="line">ORACLE_UNQNAME      Oralce唯一的数据库名称,跟V$DATABASE.DB_UNIQUE_NAME一致</span><br><span class="line">ORACLE_OWNER        Oracle用户</span><br><span class="line">LD_LIBRARY_PATH     指定查找共享库（动态链接库）时除了默认路径之外的其他路径</span><br><span class="line">CLASSPATH           Java执行环境，在哪些目录下可以找到您所要执行的Java程序所需要的类或者包</span><br><span class="line">NLS_LANG            定义语言,地域以及字符集属性</span><br><span class="line">LANG                设定系统语言</span><br><span class="line">TNS_ADMIN           确定tns管理文件的位置</span><br><span class="line">NLS_DATE_FORMAT     指定用于TO_CHAR和TO_DATE函数的默认日期格式</span><br></pre></td></tr></table></figure><h3 id="2-2-Linux-目录操作命令"><a href="#2-2-Linux-目录操作命令" class="headerlink" title="2.2 Linux 目录操作命令"></a>2.2 Linux 目录操作命令</h3><ul><li><code>cd</code> 切换到当前目录</li><li><code>cd ..</code> 切换到上一级目录</li><li><code>cd -</code> 跳到上一个目录</li><li><code>pwd</code> 显示当前文件夹的路径</li><li><code>ls -la</code> 显示目录的详细信息</li><li><code>ls -lt</code> 按照时间排序显示目录的详细信息</li><li><code>mkdir -p /u01/app/oracle</code> 递归创建/u01/app/oracle目录</li><li><code>mv dir1 /dir2</code> 将dir文件夹移动到/dir2目录</li><li><code>cp -r dir1 /dir2</code> 将dir文件夹复制到/dir目录</li><li><code>rm -r /dir</code> 删除dir目录</li><li><code>du -sh</code> 查看当前目录每个内容的大小 </li><li><code>df -hP</code> 查看文本挂载情况 </li><li><code>tree /tmp</code> 以树形式显示tmp目录的结构</li></ul><h3 id="2-3-Linux-文件操作命令"><a href="#2-3-Linux-文件操作命令" class="headerlink" title="2.3 Linux 文件操作命令"></a>2.3 Linux 文件操作命令</h3><ul><li><code>touch test</code> 创建test文本文档</li><li><code>vi test</code> 编辑test文件</li><li><code>cat test</code> 查看test文档的内容</li><li><code>head -10 test</code> 查看test文档的内容前10行</li><li><code>tail -10 test</code> 查看test文档的内容最后10行</li><li><code>more test</code> 分页显示test文本内容，按空格键显示下一页，按q退出</li><li><code>less test</code> 分页显示test文本内容，按空格键显示下一页，按q退出,按上下键进行上翻和下翻</li><li><code>mv test test1</code> test文件重命名为test1</li><li><code>cp test1 test2</code> 把test1拷贝份test2</li><li><code>rm test1</code> 删除test1文件</li></ul><h3 id="2-4-vi操作文件常用方式-需要掌握"><a href="#2-4-vi操作文件常用方式-需要掌握" class="headerlink" title="2.4 vi操作文件常用方式(需要掌握)"></a>2.4 vi操作文件常用方式(需要掌握)</h3><ul><li><strong>查看模式</strong><br><code>G(shift+g)</code>　　 跳到文件尾部<br><code>gg</code>　　　　　　  跳到文件首部<br><code>/</code>             从文本尾部开始查找某个文本<br><code>?</code>             从文本首部开始查找某个文本<br><code>dd</code>            删除一行<br><code>ndd</code>           删除多行<br><code>yy</code>            复制一行<br><code>nyy</code>           复制多行<br><code>p</code>             粘贴一行或多行<br><code>u</code>            撤消上一个操作 </li></ul><ul><li><p><strong>冒号模式</strong><br><code>:w</code>            保存<br><code>:wq</code>　　　      保存并退出<br><code>:x</code>            保存并退出<br><code>:q!</code>           不保存退出<br><code>:wq!</code>          强制保存并退出<br><code>:set number</code>   显示行号</p></li><li><p><strong>编辑模式</strong>：<br><code>a</code>             当前字符的后面插入<br><code>i</code>             当前位置插入<br><code>o</code>             当前行后面追加一个新行后插入  </p></li><li><p><strong>不同模式之间切换<code>ESC</code></strong></p></li></ul><h3 id="2-5-Linux-用户和组操作-必须掌握"><a href="#2-5-Linux-用户和组操作-必须掌握" class="headerlink" title="2.5 Linux 用户和组操作(必须掌握)"></a>2.5 Linux 用户和组操作(必须掌握)</h3><h5 id="2-5-1-用户和组增、删、改和查"><a href="#2-5-1-用户和组增、删、改和查" class="headerlink" title="2.5.1 用户和组增、删、改和查"></a>2.5.1 用户和组增、删、改和查</h5><ul><li><code>id oracle</code> 查看用户信息</li><li><code>cat /etc/passwd</code> 查看Linux口令文件<br>注册名：口令：用户标识号：组标识号：用户名：用户主目录：命令解释程序</li><li><code>useradd oracle</code> 创建用户oracle</li><li><code>useradd -u 501 oracle</code> 创建用户oracle并指定其ID为501</li><li><code>useradd -u 501 -g root oracle</code> 创建用户oracle并指定其ID为501，组为root</li><li><code>useradd -h</code> 查看useradd命令简略帮助</li><li><code>man useradd</code> 查看useradd命令详细帮助</li><li><code>usermod -u 502 oracle</code> 修改用户oracle id信息</li><li><code>usermod -g root oracle</code> 修改用户oracle组信息</li><li><code>userdel -r oracle</code> 删除oracle用户</li><li><code>passwd oracle</code> 修改用户密码</li><li><code>cat /etc/group</code> 查看组信息<br>组名：口令：组标识号：组内用户列表</li><li><code>groupadd -g 501 dba</code> 添加组信息</li><li><code>groupdel dba</code> 删除组，如果组下面有用户，要先删除用户</li><li><code>groupmod -g 502 dba</code> 修改组的gid</li><li><code>useradd -u 501  -g oinstall -G dba oracle</code> 给用户添加多个组</li><li><code>su - oracle</code> 切换用户并切换用户的配置文件</li><li><code>su oracle</code> 切换用户但不切换用户配置文件    </li></ul><h5 id="2-5-2-权限设置"><a href="#2-5-2-权限设置" class="headerlink" title="2.5.2 权限设置"></a>2.5.2 权限设置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ ls -l </span><br><span class="line">-rwxrw-r‐-1 root root 1213 Feb 2 09:39 abc</span><br><span class="line"></span><br><span class="line">- 10个字符确定不同用户能对文件干什么</span><br><span class="line">- 第一个字符代表文件（-）、目录（d），链接（l）</span><br><span class="line">- 其余字符每3个一组（rwx），读（r）、写（w）、执行（x）</span><br><span class="line">- 第一组rwx：文件所有者的权限是读、写和执行</span><br><span class="line">- 第二组rw-：与文件所有者同一组的用户的权限是读、写但不能执行</span><br><span class="line">- 第三组r--：不与文件所有者同组的其他用户的权限是读不能写和执行</span><br><span class="line">也可用数字表示为：r=4，w=2，x=1  因此rwx=4+2+1=7</span><br><span class="line">- 1 表示连接的文件数</span><br><span class="line">- root 表示用户</span><br><span class="line">- root表示用户所在的组</span><br><span class="line">- 1213 表示文件大小（字节）</span><br><span class="line">- Feb 2 09:39 表示最后修改日期</span><br><span class="line">- abc 表示文件名</span><br></pre></td></tr></table></figure><table><thead><tr><th>r</th><th style="text-align:center">w</th><th style="text-align:right">x</th></tr></thead><tbody><tr><td>4</td><td style="text-align:center">2</td><td style="text-align:right">1</td></tr></tbody></table><table><thead><tr><th>rwx</th><th style="text-align:center">r-x</th><th style="text-align:right">r-x</th></tr></thead><tbody><tr><td>user</td><td style="text-align:center">　group</td><td style="text-align:right">others</td></tr><tr><td>7</td><td style="text-align:center">5</td><td style="text-align:right">5</td></tr><tr><td>root</td><td style="text-align:center">root</td><td style="text-align:right">others  </td></tr></tbody></table><ul><li><code>chown oracle:oinstall /oracle</code>    修改某个目录权限</li><li><code>chown -R oracle:oinstall /oracle</code>  修改某个目录及其子目录权限</li><li><code>ls -ld /oracle</code>                    查看目录权限</li><li><code>chmod -R 777 /oracle</code>              设置目录为最大权</li><li><code>chmod -R 755 /oracle</code>             修改oracle目录及其子目录权限为755</li></ul><h3 id="2-6-Linux-软件的解压缩、安装、yum-需要掌握"><a href="#2-6-Linux-软件的解压缩、安装、yum-需要掌握" class="headerlink" title="2.6 Linux 软件的解压缩、安装、yum(需要掌握)"></a>2.6 Linux 软件的解压缩、安装、yum(需要掌握)</h3><h5 id="2-6-1-解压缩"><a href="#2-6-1-解压缩" class="headerlink" title="2.6.1 解压缩"></a>2.6.1 解压缩</h5><ul><li><p><strong><code>*.tar</code></strong><br><code>tar -xvf a.tar</code> 解压tar包　　<br><code>tar cvf a.tar a/</code> 将a打包成a.tar</p></li><li><p><strong><code>*.tar.gz</code></strong><br><code>tar -zxvf a.tar.gz</code> 解压a.tar.gz包<br><code>tar -zcvf a.tar.gz a</code> 将a打包成a.tar.gz.a </p></li><li><p><strong><code>*.gz</code></strong><br><code>gunzip a.gz</code> 解压a.gz<br><code>gzip -c a &gt; a.gz</code> 将a打包成a.gz(不能打包目录)</p></li><li><p><strong><code>*.bz2</code></strong><br><code>tar -jxvf a.bz2</code> 解压 a.bz2<br><code>tar -cjvf a.bz2 a</code> 将a打包成a.bz2</p></li><li><p><strong><code>*.zip</code></strong><br><code>unzip a.zip</code> 解压a.zip</p></li></ul><h5 id="2-6-2-rpm安装命令"><a href="#2-6-2-rpm安装命令" class="headerlink" title="2.6.2 rpm安装命令"></a>2.6.2 rpm安装命令</h5><ul><li><code>rpm -ivh file.rpm</code>  安装软件</li><li><code>rpm -qa|grep zsh</code>  过滤安装好的带有zsh字符的软件</li><li><code>rpm -e file.el5</code>  卸载软件</li><li><code>rpm -ga</code>  查看所以已安装软件 </li></ul><h5 id="2-6-3-yum安装命令"><a href="#2-6-3-yum安装命令" class="headerlink" title="2.6.3 yum安装命令"></a>2.6.3 yum安装命令</h5><ol><li><p>yum源配置 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">vbox-&gt;storage-&gt;controller 将iso镜像挂载在linux下 </span><br><span class="line">lsblk 查看ios镜像挂载信息</span><br><span class="line">mkdir -p /mnt/cdrom 创建目录用于挂载iso镜像</span><br><span class="line">mount -t iso9660 /dev/cdrom1 /mnt/cdrom/ 挂载 </span><br><span class="line"></span><br><span class="line"> ***可通过编辑/etc/fstab文件来时iso镜像启动挂载*** </span><br><span class="line">vi /etc/fstab </span><br><span class="line">/dev/sr1 /mnt/cdrom iso9660 defaults 0 2 在文件末尾添加该行</span><br><span class="line">移除备份共有yum配置</span><br><span class="line">mv /etc/yum.repos.d/public-yum-ol6.repo /etc/yum.repos.d/public-yum-ol6.repo.bak</span><br><span class="line">配置yum仓库</span><br><span class="line">cat &gt; /etc/yum.repos.d/base.repo &lt;&lt;EXX</span><br><span class="line">[server]</span><br><span class="line">name=server</span><br><span class="line">baseurl=file:/mnt/cdrom</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">EXX</span><br></pre></td></tr></table></figure></li><li><p>刷新yum配置源<br><code>yum clean all</code></p></li><li><p>使用yum安装软件<br><code>yum -y install --skip-broken   binutils*</code> </p></li></ol><h3 id="2-7-Linux-主机名、网络配置、网络查看-需要掌握"><a href="#2-7-Linux-主机名、网络配置、网络查看-需要掌握" class="headerlink" title="2.7 Linux 主机名、网络配置、网络查看(需要掌握)"></a>2.7 Linux 主机名、网络配置、网络查看(需要掌握)</h3><ol><li><p>设置网卡向导 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Name                 eth0</span><br><span class="line">Device               eth0</span><br><span class="line">Use DHCP             []</span><br><span class="line">Static IP            192.168.56.101</span><br><span class="line">Netmask              255.255.255.0</span><br><span class="line">Default gateway IP   192.168.56.1</span><br></pre></td></tr></table></figure></li><li><p>手动修改网络配置文件 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-eth0 </span><br><span class="line">DEVICE=eth0 </span><br><span class="line">HWADDR=08:00:27:D8:56:2E</span><br><span class="line">TYPE=Ethernet</span><br><span class="line">UUID=c63ed6ff-7a83-4b30-85e3-a09bdfd1aaba </span><br><span class="line">ONBOOT=yes</span><br><span class="line">NM_CONTROLLED=yes</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">IPADDR=192.168.56.101</span><br></pre></td></tr></table></figure></li><li><p>修改主机域名  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line">127.0.0.1       localhost.localdomain localhost  </span><br><span class="line">::1             localhost6.localdomain6 localhost6  </span><br><span class="line">192.168.56.101 test01</span><br><span class="line">vi /etc/sysconfig/network </span><br><span class="line">NETWORKING=yes</span><br><span class="line">HOSTNAME=test01</span><br></pre></td></tr></table></figure></li><li><p>重启网卡<br><code>/etc/init.d/network restart</code>  </p></li><li><p>查看网络配置信息  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ifconfig eth0 </span><br><span class="line">ifconfig -a  </span><br><span class="line">ip a  </span><br><span class="line">ip add</span><br></pre></td></tr></table></figure></li><li><p>立即刷新系统设置<br><code>su -</code> </p></li><li><p>手工修改域名  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hostname test01  </span><br><span class="line">退出终端，重新打开</span><br></pre></td></tr></table></figure></li><li><p>检查IP是否设置成功<br><code>ping 192.168.56.101</code></p></li><li><p>检查域名是否设置成功<br><code>ping test01</code></p></li><li><p>查看网络监听<br><code>netstat -lntp | grep 22</code></p></li></ol><h3 id="2-8-ssh-基本操作"><a href="#2-8-ssh-基本操作" class="headerlink" title="2.8 ssh 基本操作"></a>2.8 ssh 基本操作</h3><ul><li><code>/etc/init.d/sshd restart</code> ssh重启</li><li><code>ssh 192.168.56.101</code>  ssh登录到远程机器</li><li><code>scp -r /oracle 192.168.56.101:/tmp</code> 拷贝文件到远程主机某个目录 </li></ul><h3 id="2-9-管道命令"><a href="#2-9-管道命令" class="headerlink" title="2.9 管道命令"></a>2.9 管道命令</h3><p><code>echo &quot;this is pipe test&quot; &gt; file.log</code> 将file.log清空并写入信息<br><code>echo &quot;this is pipe test&quot; &gt;&gt; file.log</code> 将信息追加载file.log文件尾部<br><code>grep this *</code> 搜索当前目录含有this的文件</p><h3 id="2-10-Linux-优化的命令"><a href="#2-10-Linux-优化的命令" class="headerlink" title="2.10 Linux 优化的命令"></a>2.10 Linux 优化的命令</h3><ul><li><code>ps -ef |grep ora_</code> 查看进程</li><li><code>kill -9 11024</code> 终止指定进程</li><li><code>kill -9 $(ps -ef |grep xxx |grep -v grep |awk &#39;{print $2}&#39;)</code> 批量终止xxx进程</li><li><code>fuser -m -u filename</code> 查找正在使用文件的用户和进程</li><li><code>lsof -i :1158</code> 查询端口是否被占用</li><li><code>lsof -i tcp/udp</code> 查看tcp或者udp的网络连接</li><li><code>lsof -p pid</code> 查看进程</li><li><code>lsof -c command</code> 列出某个命令的进程</li><li><code>lsof -u oracle</code>  列出用户关联的进程</li><li><code>lsof filename</code> 列出某个文件的进程</li><li><code>dos2unix file</code>  windows的文件拷贝到linux上时要转字符集</li><li><code>find . -name &quot;keyword&quot;</code> 查找具体的文件名</li><li><code>watch -n 3 &quot;ls /root&quot;</code> 每隔3秒执行一个命令</li><li><code>xhost +</code> 放开图形界面的限制</li><li><code>df -h</code> 查看磁盘空间</li><li><code>free -m</code> 查看内存</li><li><code>vmstat 1 5</code> 查看系统统计信息（包括cpu,mem,io等）</li><li><code>top</code>命令<br><code>s</code> 调整刷新频率，如改成1，即每秒刷新一次<br><code>shift + P</code> 按CPU排序<br><code>shift + M</code> 按内存排序<br><code>shift + T</code> 按时间排序<br><code>shift + U</code> 按用户过滤</li></ul><h3 id="2-11-Linux-磁盘管理"><a href="#2-11-Linux-磁盘管理" class="headerlink" title="2.11 Linux 磁盘管理"></a>2.11 Linux 磁盘管理</h3><ul><li><code>fdisk -l</code> 查看各个分区的信息</li><li><code>fdisk /dev/sda</code> 进入分区模式</li><li><code>partprobe</code> 让分区操作立即生效</li><li><code>mkfs.ext3 /dev/sda5</code> 格式化某个分区</li><li><code>mount /dev/sda5 /mnt</code> 把分区mount到某个目录才能使用分区</li><li><code>umount /dev/sda5</code> 取消分区的mount操作</li><li><code>cd /etc/udev/rules.d</code> 把分区映射到某个裸设备, 并增加dba权限</li></ul>]]></content>
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>MongoDB基础操作</title>
      <link href="/2018/07/22/MongoDB%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/"/>
      <url>/2018/07/22/MongoDB%E5%9F%BA%E7%A1%80%E6%93%8D%E4%BD%9C/</url>
      <content type="html"><![CDATA[<h1 id="MOGNODB基本操作"><a href="#MOGNODB基本操作" class="headerlink" title="MOGNODB基本操作"></a>MOGNODB基本操作</h1><hr><h2 id="1-MONGODB自带SHELL客户端"><a href="#1-MONGODB自带SHELL客户端" class="headerlink" title="1. MONGODB自带SHELL客户端"></a>1. MONGODB自带SHELL客户端</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">## 切换到mongo账号</span><br><span class="line">[root@tst01 ~]# su - mongod</span><br><span class="line">## 进入mongod shell客户端  </span><br><span class="line">tst01 mongod&gt;mongo</span><br><span class="line">MongoDB shell version v3.4.10</span><br><span class="line">connecting to: mongodb://127.0.0.1:27017</span><br><span class="line">MongoDB server version: 3.4.10</span><br><span class="line">Server has startup warnings:</span><br><span class="line">2018-06-02T09:51:06.712+0800 I STORAGE  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.712+0800 I STORAGE  [initandlisten] ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine</span><br><span class="line">2018-06-02T09:51:06.712+0800 I STORAGE  [initandlisten] **          See http://dochub.mongodb.org/core/prodnotes-filesystem</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten] ** WARNING: Access control is not enabled for the database.</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten] **          Read and write access to data and configuration is unrestricted.</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten]</span><br><span class="line">2018-06-02T09:51:06.987+0800 I CONTROL  [initandlisten] ** WARNING: soft rlimits too low. rlimits set to 1024 processes, 64000 files. Number of processes should be at                       least 32000 : 0.5 times number of files.</span><br><span class="line">## 显示当前mongod服务器数据库</span><br><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">## 查看当前数据库的名称</span><br><span class="line">MongoDB Enterprise &gt; db</span><br><span class="line">test</span><br><span class="line">## 显示当前数据库的所有集合</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">## 切换到foolbar数据库,如果foolbar数据库不存在,会在该数据第一次插入之后创建</span><br><span class="line">MongoDB Enterprise &gt; use foolbar</span><br><span class="line">switched to db foolbar</span><br><span class="line">##  显示当前数据库中有哪些集合,起初应该是为NULL，但我们在创建mongod服务器时，有测试连接型的时候创建个集合,因此能看到blog集合</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">blog</span><br><span class="line">## 入数据会创建数据库(集合) 插入的数据是一个文档  </span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;title&quot;:&quot;mongodb shell client&quot;&#125;);</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">## 查找当前数据库中blog集合的所有文档</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;docment&quot;:&quot;welcome to use mongodb shell client&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c838c4dbabca2ce3b2a9&quot;), &quot;docment&quot; : &quot;welcome to use mongodb shell client&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;title&quot;:&quot;my test&quot;,&quot;name&quot;:&quot;pc&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;title&quot;:&quot;my test&quot;,&quot;name&quot;:&quot;pc&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;name&quot;:&quot;bowenz&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.insert(&#123;&quot;name&quot;:&quot;bowenz&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c838c4dbabca2ce3b2a9&quot;), &quot;docment&quot; : &quot;welcome to use mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c86dc4dbabca2ce3b2aa&quot;), &quot;title&quot; : &quot;my test&quot;, &quot;name&quot; : &quot;pc&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c873c4dbabca2ce3b2ab&quot;), &quot;title&quot; : &quot;my test&quot;, &quot;name&quot; : &quot;pc&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c888c4dbabca2ce3b2ac&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c88bc4dbabca2ce3b2ad&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">## 从当前数据库中的blog集合中移除_id为ObjectId(&quot;5b12c86dc4dbabca2ce3b2aa&quot;)的文档</span><br><span class="line">MongoDB Enterprise &gt; db.blog.remove(&#123;_id:ObjectId(&quot;5b12c86dc4dbabca2ce3b2aa&quot;)&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nRemoved&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.blog.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;), &quot;title1&quot; : &quot;instrduce of mongo&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c804c4dbabca2ce3b2a8&quot;), &quot;title&quot; : &quot;mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c838c4dbabca2ce3b2a9&quot;), &quot;docment&quot; : &quot;welcome to use mongodb shell client&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c873c4dbabca2ce3b2ab&quot;), &quot;title&quot; : &quot;my test&quot;, &quot;name&quot; : &quot;pc&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c888c4dbabca2ce3b2ac&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12c88bc4dbabca2ce3b2ad&quot;), &quot;name&quot; : &quot;bowenz&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">blog</span><br><span class="line">## 在当前数据库创建一个指定名称的集合</span><br><span class="line">MongoDB Enterprise &gt; db.createCollection(&quot;course&quot;)</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">blog</span><br><span class="line">course</span><br><span class="line">## 这个shell函数findOne会返回一个文档 而find函数会返回最多二十个文档.更多区别我们在后面详细介绍</span><br><span class="line">MongoDB Enterprise &gt; db.blog.findOne()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12664097b43b383a56e0c6&quot;),</span><br><span class="line">        &quot;title1&quot; : &quot;instrduce of mongo&quot;</span><br><span class="line">&#125;</span><br><span class="line">## 统计集合blog所有文档数量</span><br><span class="line">MongoDB Enterprise &gt; db.blog.count()</span><br><span class="line">6</span><br><span class="line">## 退出mongo客户端</span><br><span class="line">MongoDB Enterprise &gt; exit</span><br><span class="line">bye</span><br><span class="line">tst01 mongod&gt;</span><br></pre></td></tr></table></figure><h2 id="2-创建-删除数据库"><a href="#2-创建-删除数据库" class="headerlink" title="2. 创建/删除数据库"></a>2. 创建/删除数据库</h2><p>1.创建数据库语法<br>如果数据库不存在，则指向数据库，但不创建（等待实际数据入库时创建），否则切换到指定数据库。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use DATABASE_NAME</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; use webdb</span><br><span class="line">switched to db webdb</span><br><span class="line">MongoDB Enterprise &gt; db</span><br><span class="line">webdb</span><br><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">MongoDB Enterprise &gt; db.kemu.insert(&#123;&quot;name&quot;:&quot;python&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.kemu.insert(&#123;&quot;name&quot;:&quot;java&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">kemu</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><p>2.删除数据库语法<br>删除当前数据库，默认为 test，你可以使用 db 命令查看当前数据库名。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.dropDatabase()</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">webdb    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; use webdb</span><br><span class="line">switched to db webdb</span><br><span class="line">MongoDB Enterprise &gt; db.dropDatabase()</span><br><span class="line">&#123; &quot;dropped&quot; : &quot;webdb&quot;, &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><h2 id="3-创建-删除集合"><a href="#3-创建-删除集合" class="headerlink" title="3. 创建/删除集合"></a>3. 创建/删除集合</h2><p>1.创建集合语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.createCollection(name, options)</span><br></pre></td></tr></table></figure></p><p>在命令中, name 是要创建的集合的名称. Options 是一个文档，用于指定配置的集合</p><table><thead><tr><th>参数</th><th style="text-align:center">类型</th><th>描述</th></tr></thead><tbody><tr><td>Name</td><td style="text-align:center">String</td><td>要创建的集合名称</td></tr><tr><td>Options</td><td style="text-align:center">Document</td><td>（可选）指定有关内存大小和索引选项</td></tr></tbody></table><p>选项​​参数是可选的，所以只需要到指定的集合名称。以下是可以使用的选项列表：</p><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th>描述</th></tr></thead><tbody><tr><td>capped</td><td style="text-align:center">Boolean</td><td>（可选）如果为true，则启用封顶集合。封顶集合是固定大小的集合，当它达到其最大大小，会自动覆盖最早的条目。如果指定true，则需要也指定size字段。</td></tr><tr><td>autoIndexID</td><td style="text-align:center">Boolean</td><td>（可选）如果为true，自动创建索引_id字段, 默认值是false。(对于副本集，不要将AutoReXixID设置为false)</td></tr><tr><td>size</td><td style="text-align:center">number</td><td>（可选）指定集合最大可使用字节。如果封顶是 true，那么你还需要指定这个字段。</td></tr><tr><td>max</td><td style="text-align:center">number</td><td>（可选）指定封顶集合允许在文件的最大数量。Size限制优先于此限制。如果一个封顶集合达到大小size限制，未达到文件的最大数量，MongoDB删除旧的文件。如果您更喜欢使用max，确保为上限的集合所需的大小限制，足以包含文档的最大数量</td></tr></tbody></table><p>当插入文档，MongoDB 第一检查大小字段封顶集合，然后它会检查最大的字段。</p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; use example</span><br><span class="line">switched to db example</span><br><span class="line">MongoDB Enterprise &gt; db.createCollection(&quot;mycollection&quot;)</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">mycollection</span><br><span class="line">MongoDB Enterprise &gt; db.createCollection(&quot;log&quot;,&#123;capped:true,size:1024,max:2&#125;)</span><br><span class="line">&#123; &quot;ok&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">log</span><br><span class="line">mycollection</span><br><span class="line">MongoDB Enterprise &gt; db.log.insert(&#123;&quot;info&quot;:&quot;message one&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.log.insert(&#123;&quot;info&quot;:&quot;message two&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.log.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d1471f0853ff9e2fe048&quot;), &quot;info&quot; : &quot;message one&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d14a1f0853ff9e2fe049&quot;), &quot;info&quot; : &quot;message two&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.log.insert(&#123;&quot;info&quot;:&quot;message three&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">## 请注意观察这个值和上面值有何问题</span><br><span class="line">MongoDB Enterprise &gt; db.log.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d14a1f0853ff9e2fe049&quot;), &quot;info&quot; : &quot;message two&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d1581f0853ff9e2fe04a&quot;), &quot;info&quot; : &quot;message three&quot; &#125;</span><br><span class="line">## 在MongoDB中，可以不需要创建集合。当插入一些文档自动创建的集合</span><br><span class="line">MongoDB Enterprise &gt; db.sessionInfo.insert(&#123;&quot;ip&quot;:&quot;192.1.1.1&quot;,&quot;name&quot;:&quot;D98&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.sessionInfo.insert(&#123;&quot;ip&quot;:&quot;192.1.1.2&quot;,&quot;name&quot;:&quot;L98&quot;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nInserted&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">log</span><br><span class="line">mycollection</span><br><span class="line">sessionInfo</span><br><span class="line">MongoDB Enterprise &gt; db.sessionInfo.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d18d1f0853ff9e2fe04b&quot;), &quot;ip&quot; : &quot;192.1.1.1&quot;, &quot;name&quot; : &quot;D98&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d1921f0853ff9e2fe04c&quot;), &quot;ip&quot; : &quot;192.1.1.2&quot;, &quot;name&quot; : &quot;L98&quot; &#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><p>2.删除集合语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.drop()</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; show dbs</span><br><span class="line">admin    0.000GB</span><br><span class="line">example  0.000GB</span><br><span class="line">foolbar  0.000GB</span><br><span class="line">local    0.000GB</span><br><span class="line">MongoDB Enterprise &gt; use example</span><br><span class="line">switched to db example</span><br><span class="line">MongoDB Enterprise &gt; db.getCollectionNames()</span><br><span class="line">[ &quot;log&quot;, &quot;mycollection&quot;, &quot;sessionInfo&quot; ]</span><br><span class="line">MongoDB Enterprise &gt; db.log.drop()</span><br><span class="line">true</span><br><span class="line">MongoDB Enterprise &gt; db.getCollectionNames()</span><br><span class="line">[ &quot;mycollection&quot;, &quot;sessionInfo&quot; ]</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><h2 id="4-数据类型"><a href="#4-数据类型" class="headerlink" title="4. 数据类型"></a>4. 数据类型</h2><p>下表为MongoDB中常用的几种数据类型。</p><ul><li>String : 这是最常用的数据类型来存储数据。在MongoDB中的字符串必须是有效的UTF-8</li><li>Integer : 这种类型是用来存储一个数值。整数可以是32位或64位，这取决于您的服务器</li><li>Boolean : 此类型用于存储一个布尔值 (true/ false)</li><li>Double : 这种类型是用来存储浮点值</li><li>Min/ Max keys : 这种类型被用来对BSON元素的最低和最高值比较</li><li>Arrays : 使用此类型的数组或列表或多个值存储到一个键</li><li>Timestamp : 时间戳。这可以方便记录时的文件已被修改或添加</li><li>Object : 此数据类型用于嵌入式的文件</li><li>Null : 这种类型是用来存储一个Null值</li><li>Symbol : 此数据类型用于字符串相同，但它通常是保留给特定符号类型的语言使用</li><li>Date : 此数据类型用于存储当前日期或时间的UNIX时间格式。可以指定自己的日期和时间，日期和年，月，日到创建对象</li><li>Object ID : 此数据类型用于存储文档的ID</li><li>Binary data : 此数据类型用于存储二进制数据</li><li>Code : 此数据类型用于存储到文档中的JavaScript代码</li><li>Regular expression : 此数据类型用于存储正则表达式</li></ul><h2 id="5-插入文档"><a href="#5-插入文档" class="headerlink" title="5. 插入文档"></a>5. 插入文档</h2><p>要插入数据到 MongoDB 集合，需要使用 MongoDB 的 insert() 或 save() 方法。<br>对应的语法分别如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.insert(document)</span><br><span class="line">db.COLLECTION_NAME.save(document)</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">use example</span><br><span class="line">## 插入文档</span><br><span class="line">db.mycol.insert(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;MongoDB Overview&apos;, </span><br><span class="line">     description: &apos;MongoDB is no sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;mongodb&apos;, &apos;database&apos;, &apos;NoSQL&apos;],</span><br><span class="line">     likes: 100</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">db.mycol.insert(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;MySQL Overview&apos;, </span><br><span class="line">     description: &apos;MySQL is sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;MySQL&apos;, &apos;database&apos;, &apos;SQL&apos;],</span><br><span class="line">     likes: 40</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">## 查看并美化显示结果</span><br><span class="line">db.mycol.find().pretty()</span><br><span class="line"></span><br><span class="line">## 要插入单个查询的多个文档，可以传递一个数组 insert() 命令的文件</span><br><span class="line">db.mycol.insert(</span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;sqlserver&apos;, </span><br><span class="line">     description: &apos;sqlserver is sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;sqlserver&apos;, &apos;database&apos;, &apos;SQL&apos;],</span><br><span class="line">     likes: 40</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;oracle&apos;, </span><br><span class="line">     description: &apos;oracle is sql database&apos;,</span><br><span class="line">     by: &apos;tutorials itcast&apos;,</span><br><span class="line">     url: &apos;http://www.itcast.cn&apos;,</span><br><span class="line">     tags: [&apos;oracle&apos;, &apos;database&apos;, &apos;SQL&apos;],</span><br><span class="line">     likes: 40</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>insert() 或 save()区别<br>1.插入的文档的无_id<br>save() 方法等同于insert()方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.mycolone.insert(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;mongod&apos;, </span><br><span class="line">     description: &apos;mongod is nosql database&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br><span class="line">db.mycolone.save(</span><br><span class="line">  &#123;</span><br><span class="line">     title: &apos;mongod&apos;, </span><br><span class="line">     description: &apos;mongod is nosql database&apos;,</span><br><span class="line">  &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>2.插入的文档的带有”_id”<br>如果想插入的数据对象已存在数据集合中,<br>insert函数会报错,提示<code>E11000 duplicate key error collection</code><br>save函数是覆盖原来的对象<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">db.mycoltwo.insert(</span><br><span class="line">&#123;</span><br><span class="line">  _id : 2016001, </span><br><span class="line">  &quot;name&quot; : &quot;guojing&quot;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">db.mycoltwo.save(</span><br><span class="line">&#123;</span><br><span class="line">  _id : 2016001, </span><br><span class="line">  &quot;name&quot; : &quot;guojing&quot;</span><br><span class="line">&#125;</span><br><span class="line">)</span><br><span class="line">db.mycoltwo.insert(</span><br><span class="line">&#123;</span><br><span class="line">  _id : 2016001, </span><br><span class="line">  &quot;name&quot; : &quot;guojing&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><img src="/2018/07/22/MongoDB基础操作/jc_1.png" alt=""></p><h2 id="6-查询文档"><a href="#6-查询文档" class="headerlink" title="6. 查询文档"></a>6. 查询文档</h2><h3 id="6-1-基础查询语法"><a href="#6-1-基础查询语法" class="headerlink" title="6.1 基础查询语法"></a>6.1 基础查询语法</h3><p>基本的find()方法语法如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find(query, projection)</span><br></pre></td></tr></table></figure></p><ul><li>query ：可选，使用查询操作符指定查询条件</li><li>projection ：可选，使用投影操作符指定返回的键。查询时返回文档中所有键值， 只需省略该参数即可（默认省略）</li></ul><p>如果你需要以易读的方式来读取数据，可以使用 pretty() 方法，语法格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.find().pretty()</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;New MongoDB Tutorial&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB is no sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;bowenz&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MySQL Overview&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MySQL is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;lt50&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;MySQL&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;sqlserver&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;sqlserver is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;lt50&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;sqlserver&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;oracle&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;oracle is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;lt50&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;oracle&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><p>除了find() 方法外，还有一个 findOne() 法，返回一个结果 ,大家可以实战下。</p><p><strong>MongoDB 与 RDBMS Where 语句比较</strong></p><table><thead><tr><th>操作</th><th style="text-align:center">语法</th><th>例子</th><th>RDBMS 等同</th></tr></thead><tbody><tr><td>等于</td><td style="text-align:center"><code>{&lt;key&gt;:&lt;value&gt;}</code></td><td>db.mycol.find({“by”:”tutorials itcast”}).pretty()</td><td>where by = ‘tutorials itcast’</td></tr><tr><td>小于</td><td style="text-align:center"><code>{&lt;key&gt;:{$lt:&lt;value&gt;}}</code></td><td>db.mycol.find({“likes”:{$lt:50}}).pretty()</td><td>where likes &lt; 50</td></tr><tr><td>小于或等于</td><td style="text-align:center"><code>{&lt;key&gt;:{$lte:&lt;value&gt;}}</code></td><td>db.mycol.find({“likes”:{$lte:50}}).pretty()</td><td>where likes &lt;= 50</td></tr><tr><td>大于</td><td style="text-align:center"><code>{&lt;key&gt;:{$gt:&lt;value&gt;}}</code></td><td>db.mycol.find({“likes”:{$gt:50}}).pretty()</td><td>where likes &gt; 50</td></tr><tr><td>大于或等于</td><td style="text-align:center"><code>{&lt;key&gt;:{$gte:&lt;value&gt;}}</code></td><td>db.mycol.find({“likes”:{$gte:50}}).pretty()</td><td>where likes &gt;= 50</td></tr><tr><td>不等于</td><td style="text-align:center"><code>{&lt;key&gt;:{$ne:&lt;value&gt;}}</code></td><td>db.mycol.find({“likes”:{$ne:50}}).pretty()</td><td>where likes != 50</td></tr></tbody></table><p><strong>AND 在MongoDB中用法</strong><br>MongoDB 的 find() 方法可以传入多个键(key)，每个键(key)以逗号隔开，即常规 SQL 的 AND 条件。<br>语法格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find(&#123;key1:value1, key2:value2&#125;).pretty()</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&quot;title&quot;:&quot;oracle&quot;,&quot;by&quot;:&quot;lt50&quot;&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p><strong>MongoDB中OR</strong><br>MongoDB OR 条件语句使用了关键字 $or,语法格式如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find(&#123;$or: [&#123;key1: value1&#125;, &#123;key2:value2&#125;]&#125;).pretty()</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;$or:[&#123;&quot;title&quot;:&quot;oracle&quot;&#125;,&#123;&quot;title&quot;:&quot;New MongoDB Tutorial&quot;&#125;]&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p><strong>AND 和 OR 一起使用</strong><br>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&quot;by&quot;:&quot;lt50&quot;,$or:[&#123;&quot;title&quot;:&quot;oracle&quot;&#125;,&#123;&quot;title&quot;:&quot;sqlserver&quot;&#125;]&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p><strong>projection 参数的使用方法</strong><br>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&quot;by&quot;:&quot;lt50&quot;&#125;,&#123;&quot;title&quot;:1,&quot;by&quot;:1&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;by&quot; : &quot;lt50&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;by&quot; : &quot;lt50&quot; &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;by&quot; : &quot;lt50&quot; &#125;</span><br></pre></td></tr></table></figure></p><h3 id="6-2-Limit和Skip"><a href="#6-2-Limit和Skip" class="headerlink" title="6.2 Limit和Skip"></a>6.2 Limit和Skip</h3><p>如果你需要在MongoDB中读取指定数量的数据记录，可以使用MongoDB的Limit方法，limit()方法接受一个数字参数，该参数指定从MongoDB中读取的记录条数。<br>limit()方法基本语法如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().limit(NUMBER)</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find().limit(2)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p>我们除了可以使用limit()方法来读取指定数量的数据外，还可以使用skip()方法来跳过指定数量的数据，skip方法同样接受一个数字参数作为跳过的记录条数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().limit(NUMBER).skip(NUMBER)</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find().skip(2).limit(1)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><h3 id="6-3-MONGODB排序-distinct"><a href="#6-3-MONGODB排序-distinct" class="headerlink" title="6.3 MONGODB排序/distinct"></a>6.3 MONGODB排序/distinct</h3><p>在MongoDB中使用使用sort()方法对数据进行排序，sort()方法可以通过参数指定排序的字段，并使用 1 和 -1 来指定排序的方式，其中 1 为升序排列，而-1是用于降序排列。<br>sort()方法基本语法如下所示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.col.find().sort(&#123;KEY:1&#125;)</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&#125;,&#123;&quot;title&quot;:1,&quot;likes&quot;:1&#125;).sort(&#123;&quot;likes&quot;:1&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;likes&quot; : 100 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find(&#123;&#125;,&#123;&quot;title&quot;:1,&quot;likes&quot;:1&#125;).sort(&#123;&quot;likes&quot;:-1&#125;)</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p>在MongoDB中使用使用distinct()方法对数据进行去重。<br>distinct方法基本语法如下所示:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.distinct(field, query)</span><br></pre></td></tr></table></figure></p><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.distinct(&quot;likes&quot;)</span><br><span class="line">[ 100, 40 ]</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.distinct(&quot;by&quot;)</span><br><span class="line">[ &quot;bowenz&quot;, &quot;lt50&quot; ]</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.distinct(&quot;title&quot;)</span><br><span class="line">[ &quot;New MongoDB Tutorial&quot;, &quot;MySQL Overview&quot;, &quot;sqlserver&quot;, &quot;oracle&quot; ]</span><br></pre></td></tr></table></figure></p><h3 id="6-4-MONGODB聚合"><a href="#6-4-MONGODB聚合" class="headerlink" title="6.4 MONGODB聚合"></a>6.4 MONGODB聚合</h3><h4 id="6-4-1-aggregate语法"><a href="#6-4-1-aggregate语法" class="headerlink" title="6.4.1 aggregate语法"></a>6.4.1 aggregate语法</h4><p>MongoDB中聚合(aggregate)主要用于处理数据(诸如统计平均值,求和等)，并返回计算后的数据结果。有点类似sql语句中的 count(*), sum(), avg()。</p><p>aggregate()语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.COLLECTION_NAME.aggregate(AGGREGATE_OPERATION)</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.mycol.aggregate(</span><br><span class="line">[</span><br><span class="line">  &#123; </span><br><span class="line">    $group:&#123;</span><br><span class="line">_id:&quot;$by&quot;,</span><br><span class="line">num_tutorial:&#123;</span><br><span class="line">$sum:1</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure><p>执行上诉语句得到以下结果:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123; &quot;_id&quot; : &quot;lt50&quot;, &quot;num_tutorial&quot; : 3 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : &quot;bowenz&quot;, &quot;num_tutorial&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><p>在上面的例子中，我们通过字段by字段对数据进行分组，并计算by字段相同值的总和。<br>下表展示了一些聚合的表达式:</p><table><thead><tr><th>表达式</th><th style="text-align:center">描述</th><th>实例</th></tr></thead><tbody><tr><td>$sum</td><td style="text-align:center">计算总和</td><td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$sum : “$likes”}}}])</td></tr><tr><td>$avg</td><td style="text-align:center">计算平均值</td><td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$avg : “$likes”}}}])</td></tr><tr><td>$min</td><td style="text-align:center">获取集合中所有文档对应值得最小值</td><td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$min : “$likes”}}}])</td></tr><tr><td>$max</td><td style="text-align:center">获取集合中所有文档对应值得最大值</td><td>db.mycol.aggregate([{$group : {_id : “$by”, num_tutorial : {$max : “$likes”}}}])</td></tr><tr><td>$push</td><td style="text-align:center">在结果文档中插入值到一个数组中</td><td>db.mycol.aggregate([{$group : {_id : “$by”, url : {$push: “$url”}}}])</td></tr><tr><td>$addToSet</td><td style="text-align:center">在结果文档中插入值到一个数组中，但不创建副本</td><td>db.mycol.aggregate([{$group : {_id : “$by”, url : {$addToSet : “$url”}}}])</td></tr><tr><td>$first</td><td style="text-align:center">根据资源文档的排序获取第一个文档数据</td><td>db.mycol.aggregate([{$group : {_id : “$by”, first_url : {$first : “$url”}}}])</td></tr><tr><td>$last</td><td style="text-align:center">根据资源文档的排序获取最后一个文档数据</td><td>db.mycol.aggregate([{$group : {_id : “$by”, last_url : {$last : “$url”}}}])</td></tr></tbody></table><p>以下语句的含义呢？<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.mycol.aggregate([&#123;$group : &#123;_id : &#123;by:&quot;$by&quot;,url:&quot;$url&quot;&#125;, num_tutorial : &#123;$sum : &quot;$likes&quot;&#125;&#125;&#125;])</span><br></pre></td></tr></table></figure></p><h4 id="6-4-2-管道"><a href="#6-4-2-管道" class="headerlink" title="6.4.2 管道"></a>6.4.2 管道</h4><p>管道在Unix和Linux中一般用于将当前命令的输出结果作为下一个命令的输入。如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@tst01 ~]# ll</span><br><span class="line">total 104</span><br><span class="line">-rw-------. 1 root root  1554 May 30 21:20 anaconda-ks.cfg</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Desktop</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Documents</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Downloads</span><br><span class="line">-rw-r--r--. 1 root root 51788 May 30 21:20 install.log</span><br><span class="line">-rw-r--r--. 1 root root 10033 May 30 21:17 install.log.syslog</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Music</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Pictures</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Public</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Templates</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Videos</span><br><span class="line">[root@tst01 ~]# ll | grep Des</span><br><span class="line">drwxr-xr-x. 2 root root  4096 May 30 21:21 Desktop</span><br></pre></td></tr></table></figure></p><p>MongoDB的聚合管道将MongoDB文档在一个管道处理完毕后将结果传递给下一个管道处理。管道操作是可以重复的。<br>表达式：处理输入文档并输出。表达式是无状态的，只能用于计算当前聚合管道的文档，不能处理其它的文档。<br>聚合管道示意图：<br><img src="/2018/07/22/MongoDB基础操作/jc_2.png" alt=""></p><p>相当于Sql语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Select cust_id,sum(amount)as total from orders where status= &quot;A&quot; group by cust_id</span><br></pre></td></tr></table></figure></p><p>这里我们介绍一下聚合框架中常用的几个操作：</p><ul><li>$project：修改输入文档的结构。可以用来重命名、增加或删除域，也可以用于创建计算结果以及嵌套文档。</li><li>$match：用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。</li><li>$limit：用来限制MongoDB聚合管道返回的文档数。</li><li>$skip：在聚合管道中跳过指定数量的文档，并返回余下的文档。</li><li>$unwind：将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值。</li><li>$group：将集合中的文档分组，可用于统计结果。</li><li>$sort：将输入文档排序后输出。</li><li>$lookup :joined集合中的匹配文档。</li></ul><h5 id="6-4-2-1-project"><a href="#6-4-2-1-project" class="headerlink" title="6.4.2.1 $project"></a>6.4.2.1 $project</h5><p>修改输入文档的结构。可以用来重命名、增加或删除字段(域)，也可以用于创建计算结果以及嵌套文档。<br>思考，现有books集合内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">db.books.insert(</span><br><span class="line">[</span><br><span class="line">&#123;</span><br><span class="line">  title: &quot;mongodb course&quot;,</span><br><span class="line">  isbn: &quot;0001122223334&quot;,</span><br><span class="line">  author: &#123; last: &quot;bowen&quot;, first: &quot;zhuang&quot; &#125;,</span><br><span class="line">  copies: 5</span><br><span class="line">&#125;,</span><br><span class="line">&#123;</span><br><span class="line">  title: &quot;mysql course&quot;,</span><br><span class="line">  isbn: &quot;0001122223334&quot;,</span><br><span class="line">  author: &#123; last: &quot;bowen&quot;, first: &quot;zhuang&quot; &#125;,</span><br><span class="line">  copies: 6</span><br><span class="line">&#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><ol><li><p>指定输出字段</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( [ &#123; $project: &#123; title: 1, author: 1 &#125; &#125; ] )</span><br><span class="line">db.books.aggregate( &#123; $project: &#123; _id: 0, title: 1, author: 1 &#125; &#125;)</span><br></pre></td></tr></table></figure></li><li><p>输出嵌入式文档中field</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( &#123; $project: &#123; _id: 0, title: 1, &quot;author.last&quot;: 1 &#125; &#125;)</span><br></pre></td></tr></table></figure></li><li><p>改变输出结构</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( &#123; $project: &#123; _id: 0, title: 1, &quot;lastName&quot;: &quot;$author.last&quot; &#125; &#125;)</span><br></pre></td></tr></table></figure></li><li><p>计算 Fields<br>substr 语法： <code>{ $substr: [ &lt;string&gt;, &lt;start&gt;, &lt;length&gt; ] }</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.books.aggregate( [ &#123; $project: &#123; title: 1, isbn: &#123;</span><br><span class="line">prefix: &#123; $substr: [ &quot;$isbn&quot;, 1, 3 ] &#125;, &#125;, </span><br><span class="line">lastName: &quot;$author.last&quot;, copiesSold: &quot;$copies&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure></li></ol><h5 id="6-4-2-2-match"><a href="#6-4-2-2-match" class="headerlink" title="6.4.2.2 $match"></a>6.4.2.2 $match</h5><p>用于过滤数据，只输出符合条件的文档。$match使用MongoDB的标准查询操作。<br>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">db.articles.insert([ &#123; &quot;_id&quot; : 1, &quot;author&quot; : &quot;dave&quot;, &quot;score&quot; : 80, &quot;views&quot; : 100 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;author&quot; : &quot;dave&quot;, &quot;score&quot; : 85, &quot;views&quot; : 521 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;author&quot; : &quot;ahn&quot;, &quot;score&quot; : 60, &quot;views&quot; : 1000 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;author&quot; : &quot;li&quot;, &quot;score&quot; : 55, &quot;views&quot; : 5000 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;author&quot; : &quot;annT&quot;, &quot;score&quot; : 60, &quot;views&quot; : 50 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 6, &quot;author&quot; : &quot;li&quot;, &quot;score&quot; : 94, &quot;views&quot; : 999 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 7, &quot;author&quot; : &quot;ty&quot;, &quot;score&quot; : 95, &quot;views&quot; : 1000 &#125; ])</span><br></pre></td></tr></table></figure></p><ol><li><p>Match 匹配</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate([ &#123; $match : &#123; author : &quot;dave&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure></li><li><p>范围条件匹配</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate([ &#123; $match: &#123; $or: [ &#123; score: &#123; $gt: 70, $lt: 90 &#125; &#125;, &#123; views: &#123; $gte: 1000 &#125; &#125; ] &#125; &#125; ])</span><br></pre></td></tr></table></figure></li><li><p>计算Count值</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate( [ &#123; $match: &#123; $or: [ &#123; score: &#123; $gt: 70, $lt: 90 &#125; &#125;, </span><br><span class="line">&#123; views: &#123; $gte: 1000 &#125; &#125; ] &#125; &#125;, </span><br><span class="line">&#123; $group: &#123; _id: null, count: &#123; $sum: 1 &#125; &#125; &#125; ] )</span><br></pre></td></tr></table></figure></li></ol><h5 id="6-4-2-3-group"><a href="#6-4-2-3-group" class="headerlink" title="6.4.2.3 $group"></a>6.4.2.3 $group</h5><p>将集合中的文档分组，可用于统计结果。<br>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.sales.insert([ &#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : 10, &quot;quantity&quot; : 2, &quot;date&quot; : ISODate(&quot;2014-03-01T08:00:00Z&quot;) &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;jkl&quot;, &quot;price&quot; : 20, &quot;quantity&quot; : 1, &quot;date&quot; : ISODate(&quot;2014-03-01T09:00:00Z&quot;) &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;xyz&quot;, &quot;price&quot; : 5, &quot;quantity&quot; : 10, &quot;date&quot; : ISODate(&quot;2014-03-15T09:00:00Z&quot;) &#125;, &#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;xyz&quot;, &quot;price&quot; : 5, &quot;quantity&quot; : 20, &quot;date&quot; : ISODate(&quot;2014-04-04T11:21:39.736Z&quot;) &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : 10, &quot;quantity&quot; : 10, &quot;date&quot; : ISODate(&quot;2014-04-04T21:23:13.331Z&quot;) &#125; ])</span><br></pre></td></tr></table></figure></p><p>下面的聚合操作使用 $group 将文档按月、日、年组分组, 计算平均数量以及每个组的文档数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate(</span><br><span class="line">   [</span><br><span class="line">      &#123;</span><br><span class="line">        $group : &#123;</span><br><span class="line">           _id : &#123; month: &#123; $month: &quot;$date&quot; &#125;, day: &#123; $dayOfMonth: &quot;$date&quot; &#125;, year: &#123; $year: &quot;$date&quot; &#125; &#125;,</span><br><span class="line">           averageQuantity: &#123; $avg: &quot;$quantity&quot; &#125;,</span><br><span class="line">           count: &#123; $sum: 1 &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>下面的聚合操作指定_id 等于null的空组，计算总价格和平均数量以及集合中的所有文件数：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate(</span><br><span class="line">   [</span><br><span class="line">      &#123;</span><br><span class="line">        $group : &#123;</span><br><span class="line">           _id : null,</span><br><span class="line">           totalPrice: &#123; $sum: &#123; $multiply: [ &quot;$price&quot;, &quot;$quantity&quot; ] &#125; &#125;,</span><br><span class="line">           averageQuantity: &#123; $avg: &quot;$quantity&quot; &#125;,</span><br><span class="line">           count: &#123; $sum: 1 &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">   ]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>下面的聚合操作使用 $group 将item字段去重，以检索不同的项目值：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.sales.aggregate( [ &#123; $group : &#123; _id : &quot;$item&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure></p><p>集合$match,做个复杂的聚合运算<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">db.articles.aggregate(</span><br><span class="line">[</span><br><span class="line">  &#123;$match: &#123;$or: [&#123;views:&#123;$gte:1000&#125;&#125;,&#123;score:&#123;$gt:70,$lt:90&#125;&#125;]&#125; &#125;,</span><br><span class="line">  &#123;$group: &#123;_id:&quot;$author&quot;,sum_score:&#123;$sum: &quot;$score&quot;&#125;,avg_views:&#123;$avg:&quot;$views&quot;&#125;&#125;&#125;</span><br><span class="line">]</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><h5 id="6-4-2-4-unwind"><a href="#6-4-2-4-unwind" class="headerlink" title="6.4.2.4 $unwind"></a>6.4.2.4 $unwind</h5><p>将文档中的某一个数组类型字段拆分成多条，每条包含数组中的一个值<br>语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  $unwind:</span><br><span class="line">    &#123;</span><br><span class="line">      path: &lt;field path&gt;,          #拆分路径</span><br><span class="line">      includeArrayIndex: &lt;string&gt;,   #指定数组索引号</span><br><span class="line">      preserveNullAndEmptyArrays: &lt;boolean&gt;   #防止数据丢失</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.shoes.insert([ &#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;ABC&quot;, &quot;sizes&quot;: [ &quot;S&quot;, &quot;M&quot;, &quot;L&quot;] &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;EFG&quot;, &quot;sizes&quot; : [ ] &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;IJK&quot;, &quot;sizes&quot;: &quot;M&quot; &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;LMN&quot; &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;XYZ&quot;, &quot;sizes&quot; : null &#125; ])</span><br></pre></td></tr></table></figure></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.shoes.aggregate( [ &#123; $unwind: &quot;$sizes&quot; &#125; ] )</span><br><span class="line">db.shoes.aggregate( [ &#123; $unwind: &#123; path: &quot;$sizes&quot; &#125; &#125; ] )</span><br><span class="line">db.shoes.aggregate( [ &#123; $unwind: &#123; path: &quot;$sizes&quot;,preserveNullAndEmptyArrays:true&#125; &#125; ] )</span><br><span class="line">db.shoes.aggregate( [ &#123; $unwind: &#123; path: &quot;$sizes&quot;, includeArrayIndex: &quot;arrayIndex&quot; &#125; &#125; ] )</span><br></pre></td></tr></table></figure><h5 id="6-4-2-4-lookup"><a href="#6-4-2-4-lookup" class="headerlink" title="6.4.2.4 $lookup"></a>6.4.2.4 $lookup</h5><p>执行左连接到一个集合(unsharded)，必须在同一数据库中<br>$lookup添加了一个新的数组字段，该字段的元素是joined集合中的匹配文档。</p><p>$lookup 语法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">   $lookup:</span><br><span class="line">     &#123;</span><br><span class="line">       from: &lt;collection to join&gt;,   #右集合</span><br><span class="line">       localField: &lt;field from the input documents&gt;,  #左集合 join字段</span><br><span class="line">       foreignField: &lt;field from the documents of the &quot;from&quot; collection&gt;, #右集合 join字段</span><br><span class="line">       as: &lt;output array field&gt;   #新生成字段（类型array）</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><table><thead><tr><th>Field</th><th style="text-align:center">Description</th></tr></thead><tbody><tr><td>from</td><td style="text-align:center">右集合，指定在同一数据库中执行连接的集合。此集合不能shared分片</td></tr><tr><td>localField</td><td style="text-align:center">指定左集合（db.collectionname）匹配的字段。如果左集合不包含localField，$lookup 视为null值来匹配</td></tr><tr><td>foreignField</td><td style="text-align:center">指定from集合（右集合）用来匹配的字段。如果集合不包含该字段，$lookup 视为null值来匹配</td></tr><tr><td>as</td><td style="text-align:center">指定要添加到输入文档的新数组字段的名称。新的数组字段包含from集合中匹配的文档。如果在文档中指定的名称已经存在，现有的领域覆盖</td></tr></tbody></table><p>实例<br><strong>使用$lookup集合连接</strong><br>左集合 <code>orders</code> 内容如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db.orders.insert([ &#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;abc&quot;, &quot;price&quot; : 12, &quot;quantity&quot; : 2 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;jkl&quot;, &quot;price&quot; : 20, &quot;quantity&quot; : 1 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3 &#125; ])</span><br></pre></td></tr></table></figure></p><p>另外一个右集合 <code>products</code> 内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db.products.insert([ &#123; &quot;_id&quot; : 1, &quot;sku&quot; : &quot;abc&quot;, description: &quot;product 1&quot;, &quot;instock&quot; : 120 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;sku&quot; : &quot;def&quot;, description: &quot;product 2&quot;, &quot;instock&quot; : 80 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;sku&quot; : &quot;ijk&quot;, description: &quot;product 3&quot;, &quot;instock&quot; : 60 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;sku&quot; : &quot;jkl&quot;, description: &quot;product 4&quot;, &quot;instock&quot; : 70 &#125;, </span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;sku&quot;: null, description: &quot;Incomplete&quot; &#125;, &#123; &quot;_id&quot; : 6 &#125; ])</span><br></pre></td></tr></table></figure></p><p>以下聚合操作对 <code>orders</code>左集合 左连接 <code>products</code> 右集合，通过 <code>orders</code>下的<code>item</code> 与 <code>products</code> 集合的<code>sku</code>：<br>值得注意：</p><ul><li>两个集合必须在同一个db</li><li>orders是左集合，左连接</li><li>item是orders左集合字段</li><li>sku是products右集合字段</li><li>item为null, 左连接, 右集合 sku为null</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.orders.aggregate([ &#123; $lookup: &#123; from: &quot;products&quot;, localField: &quot;item&quot;, foreignField: &quot;sku&quot;, as: &quot;product_docs&quot; &#125; &#125; ]).pretty()</span><br></pre></td></tr></table></figure><h5 id="6-4-2-4-out"><a href="#6-4-2-4-out" class="headerlink" title="6.4.2.4 $out"></a>6.4.2.4 $out</h5><p>输出到集合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">db.orders.aggregate([ &#123; $lookup: &#123; from: &quot;products&quot;, localField: &quot;item&quot;, foreignField: &quot;sku&quot;, as: &quot;product_docs&quot; &#125; &#125;,</span><br><span class="line">&#123; $out : &quot;order_details&quot; &#125;</span><br><span class="line"> ])</span><br><span class="line">db.order_details.find()</span><br></pre></td></tr></table></figure></p><h2 id="7-更新-删除文档"><a href="#7-更新-删除文档" class="headerlink" title="7. 更新/删除文档"></a>7. 更新/删除文档</h2><p>MongoDB 使用 update() 和 save() 方法来更新集合中的文档。接下来让我们详细来看下两个函数的应用及其区别。<br>update() 方法的基本语法如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">db.collection.update(</span><br><span class="line">   &lt;query&gt;,</span><br><span class="line">   &lt;update&gt;,</span><br><span class="line">   &#123;</span><br><span class="line">     upsert: &lt;boolean&gt;,</span><br><span class="line">     multi: &lt;boolean&gt;,</span><br><span class="line">     writeConcern: &lt;document&gt;</span><br><span class="line">   &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure></p><p>参数说明：</p><ul><li>query : update的查询条件，类似sql update查询内where后面的</li><li>update : update的对象和一些更新的操作符（如$,$inc…）等，也可以理解为sql update查询内set后面的</li><li>upsert : 可选，这个参数的意思是，如果不存在update的记录，是否插入objNew，true为插入，默认是false，不插入</li><li>multi : 可选，mongodb 默认是false，只更新找到的第一条记录，如果这个参数为true，就把按条件查出来多条记录全部更新</li><li>writeConcern :可选，抛出异常的级别</li></ul><p>实例<br>考虑用以下数据集合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; use example</span><br><span class="line">switched to db example</span><br><span class="line">MongoDB Enterprise &gt; show collections</span><br><span class="line">mycol</span><br><span class="line">mycollection</span><br><span class="line">mycolone</span><br><span class="line">mycoltwo</span><br><span class="line">sessionInfo</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find().pretty()</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MongoDB Overview&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MongoDB is no sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;mongodb&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;NoSQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 100</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;MySQL Overview&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;MySQL is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;MySQL&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;sqlserver&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;sqlserver is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;sqlserver&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">&#123;</span><br><span class="line">        &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;),</span><br><span class="line">        &quot;title&quot; : &quot;oracle&quot;,</span><br><span class="line">        &quot;description&quot; : &quot;oracle is sql database&quot;,</span><br><span class="line">        &quot;by&quot; : &quot;tutorials itcast&quot;,</span><br><span class="line">        &quot;url&quot; : &quot;http://www.itcast.cn&quot;,</span><br><span class="line">        &quot;tags&quot; : [</span><br><span class="line">                &quot;oracle&quot;,</span><br><span class="line">                &quot;database&quot;,</span><br><span class="line">                &quot;SQL&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;likes&quot; : 40</span><br><span class="line">&#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><p>下面的例子将设置标题MongoDB Overview的文件，更新其标题是New MongoDB Tutorial<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.update(&#123;&quot;title&quot;:&quot;MongoDB Overview&quot;&#125;,&#123;$set:&#123;&quot;title&quot;:&quot;New MongoDB Tutorial&quot;&#125;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p>MongoDB默认将只更新单一的文件，来更新多个你需要设置参数置multi为true<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">MongoDB Enterprise &gt; db.mycol.update(&#123;&quot;by&quot;:&quot;tutorials itcast&quot;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;bowenz&quot;&#125;&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 1, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 1 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;tutorials itcast&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.update(&#123;&quot;by&quot;:&quot;tutorials itcast&quot;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;bowenz&quot;&#125;&#125;,&#123;multi:true&#125;)</span><br><span class="line">WriteResult(&#123; &quot;nMatched&quot; : 3, &quot;nUpserted&quot; : 0, &quot;nModified&quot; : 3 &#125;)</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br></pre></td></tr></table></figure></p><p>save() 方法覆盖原有的文档 或者 插入新的文档，我们在<code>插入文档</code>部分已介绍，在此不在重复.</p><p><strong>在3.2版本开始，MongoDB提供以下更新集合文档的方法：</strong></p><ul><li>db.collection.updateOne() 向指定集合更新单个文档</li><li>db.collection.updateMany() 向指定集合更新多个文档</li></ul><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># updateOne</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.updateOne(&#123;&quot;likes&quot;:&#123;$lt:50&#125;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;lt50&quot;&#125;&#125;)</span><br><span class="line">&#123; &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 1, &quot;modifiedCount&quot; : 1 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line"></span><br><span class="line"># updateMany</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.updateMany(&#123;&quot;likes&quot;:&#123;$lt:50&#125;&#125;,&#123;$set:&#123;&quot;by&quot;:&quot;lt50&quot;&#125;&#125;)</span><br><span class="line">&#123; &quot;acknowledged&quot; : true, &quot;matchedCount&quot; : 3, &quot;modifiedCount&quot; : 2 &#125;</span><br><span class="line">MongoDB Enterprise &gt; db.mycol.find()</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4461f0853ff9e2fe04d&quot;), &quot;title&quot; : &quot;New MongoDB Tutorial&quot;, &quot;description&quot; : &quot;MongoDB is no sql database&quot;, &quot;by&quot; : &quot;bowenz&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;mongodb&quot;, &quot;database&quot;, &quot;NoSQL&quot; ], &quot;likes&quot; : 100 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d44c1f0853ff9e2fe04e&quot;), &quot;title&quot; : &quot;MySQL Overview&quot;, &quot;description&quot; : &quot;MySQL is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;MySQL&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe04f&quot;), &quot;title&quot; : &quot;sqlserver&quot;, &quot;description&quot; : &quot;sqlserver is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;sqlserver&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">&#123; &quot;_id&quot; : ObjectId(&quot;5b12d4821f0853ff9e2fe050&quot;), &quot;title&quot; : &quot;oracle&quot;, &quot;description&quot; : &quot;oracle is sql database&quot;, &quot;by&quot; : &quot;lt50&quot;, &quot;url&quot; : &quot;http://www.itcast.cn&quot;, &quot;tags&quot; : [ &quot;oracle&quot;, &quot;database&quot;, &quot;SQL&quot; ], &quot;likes&quot; : 40 &#125;</span><br><span class="line">MongoDB Enterprise &gt;</span><br></pre></td></tr></table></figure></p><h2 id="8-索引"><a href="#8-索引" class="headerlink" title="8. 索引"></a>8. 索引</h2><p>索引通常能够极大的提高查询的效率，如果没有索引，MongoDB在读取数据时必须扫描集合中的每个文档并选取那些符合查询条件的记录。<br>这种扫描全集合的查询效率是非常低的，特别在处理大量的数据时，查询可以要花费几十秒甚至几分钟，这对网站的性能是非常致命的。<br>索引是特殊的数据结构，索引存储在一个易于遍历读取的数据集合中，索引是对数据库表中一列或多列的值进行排序的一种结构</p><p>语法:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.collection.createIndex(&#123;keys:1&#125;, options)</span><br></pre></td></tr></table></figure></p><p>语法中 Keys 值为你要创建的索引字段，1为指定按升序创建索引，-1即为降序。</p><table><thead><tr><th>参数</th><th style="text-align:center">类型</th><th>描述</th></tr></thead><tbody><tr><td>keys</td><td style="text-align:center">document</td><td>创建索引的字段</td></tr><tr><td>Options</td><td style="text-align:center">document</td><td>可选的。 包含一组控制索引创建的选项的文档。 详细信息请参阅选项。</td></tr></tbody></table><p>选项​​参数是可选的,以下是可以使用的选项列表：</p><table><thead><tr><th>字段</th><th style="text-align:center">类型</th><th>描述</th></tr></thead><tbody><tr><td>background</td><td style="text-align:center">Boolean</td><td>可选的。 在后台构建索引，以便操作不会阻止其他数据库活动。 指定true以在后台构建。 默认值是false</td></tr><tr><td>unique</td><td style="text-align:center">Boolean</td><td>（可选）为true时，创建唯一索引</td></tr><tr><td>name</td><td style="text-align:center">string</td><td>（可选）索引的名称</td></tr><tr><td>partialFilterExpression</td><td style="text-align:center">document</td><td>可选的。 如果指定，则索引仅引用与过滤器表达式匹配的文档。 有关更多信息，有兴趣的可以参考<a href="https://docs.mongodb.com/manual/reference/method/db.collection.createIndex/" target="_blank" rel="noopener">mongodb document index</a></td></tr><tr><td>sparse</td><td style="text-align:center">Boolean</td><td>对文档中不存在的字段数据不启用索引；这个参数需要特别注意，如果设置为true的话，在索引字段中不会查询出不包含对应字段的文档.。默认值为 false.</td></tr><tr><td>expireAfterSeconds</td><td style="text-align:center">integer</td><td>指定一个以秒为单位的数值，完成 TTL设定，设定集合的生存时间</td></tr><tr><td>storageEngine</td><td style="text-align:center">document</td><td>可选的。 允许用户在创建索引时按每个索引配置存储引擎。</td></tr></tbody></table><p>实例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">## 插入数据</span><br><span class="line">db.inventory.insert([</span><br><span class="line">&#123; &quot;_id&quot; : 1, &quot;item&quot; : &quot;f1&quot;, type: &quot;food&quot;, quantity: 500 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 2, &quot;item&quot; : &quot;f2&quot;, type: &quot;food&quot;, quantity: 100 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 3, &quot;item&quot; : &quot;p1&quot;, type: &quot;paper&quot;, quantity: 200 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 4, &quot;item&quot; : &quot;p2&quot;, type: &quot;paper&quot;, quantity: 150 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 5, &quot;item&quot; : &quot;f3&quot;, type: &quot;food&quot;, quantity: 300 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 6, &quot;item&quot; : &quot;t1&quot;, type: &quot;toys&quot;, quantity: 500 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 7, &quot;item&quot; : &quot;a1&quot;, type: &quot;apparel&quot;, quantity: 250 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 8, &quot;item&quot; : &quot;a2&quot;, type: &quot;apparel&quot;, quantity: 400 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 9, &quot;item&quot; : &quot;t2&quot;, type: &quot;toys&quot;, quantity: 50 &#125;,</span><br><span class="line">&#123; &quot;_id&quot; : 10, &quot;item&quot; : &quot;f4&quot;, type: &quot;food&quot;, quantity: 75 &#125;])</span><br><span class="line">## 创建索引</span><br><span class="line">db.inventory.createIndex(&#123; quantity: 1&#125;)</span><br><span class="line">## 获取集合inventory的所有索引</span><br><span class="line">db.inventory.getIndexes()</span><br><span class="line">## 删除索引；通过getIndexes获取index的名称</span><br><span class="line">db.inventory.dropIndex(&quot;quantity_1&quot;)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MongoDB </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>DB思维导图</title>
      <link href="/2018/07/21/DB%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/"/>
      <url>/2018/07/21/DB%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE/</url>
      <content type="html"><![CDATA[<p><img src="/2018/07/21/DB思维导图/image1.png" alt=""></p>]]></content>
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> DB </tag>
            
            <tag> 思维导图 </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>GoldenGate Big Data 实验</title>
      <link href="/2018/07/19/OGGBG/"/>
      <url>/2018/07/19/OGGBG/</url>
      <content type="html"><![CDATA[<h1 id="GoldenGate-Big-Data-实验"><a href="#GoldenGate-Big-Data-实验" class="headerlink" title="GoldenGate Big Data 实验"></a>GoldenGate Big Data 实验</h1><hr><h2 id="Install-GoldenGate-Big-Data"><a href="#Install-GoldenGate-Big-Data" class="headerlink" title="Install GoldenGate Big Data"></a>Install GoldenGate Big Data</h2><ol><li>Request Install JDK 8 on OS</li><li><p>Configure Variables on OS</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.8.0_121 </span><br><span class="line">export JRE_HOME=/usr/java/jdk1.8.0_121/jre</span><br><span class="line">export CLASSPATH=$JAVA_HOME/lib:$JRE_HOME/lib:./</span><br><span class="line">export GG_HOME=/data/oggbg</span><br><span class="line">export LD_LIBRARY_PATH=$JAVA_HOME/lib:$JAVA_HOME/jre/lib:$JAVA_HOME/jre/lib/amd64/server:$JAVA_HOME/jre/lib/amd64:$GG_HOME:$GG_HOME/lib</span><br><span class="line">export PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/lib:$PATH:$GG_HOME</span><br></pre></td></tr></table></figure></li><li><p>Installation Steps</p><ul><li><p>Create an installation directory that has no spaces in its name. Then extract the ZIP file into this new installation directory. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Shell&gt; mkdir installation_directory </span><br><span class="line">Shell&gt; cp path/to/installation_zip installation_directory </span><br><span class="line">Shell&gt; cd installation_directory </span><br><span class="line">Shell&gt; unzip installation_zip </span><br><span class="line">Shell&gt; tar -xf installation_tar</span><br></pre></td></tr></table></figure></li><li><p>Stay on the installation directory and bring up GGSCI to create the remaining subdirectories in the installation location</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Shell&gt; ggsci </span><br><span class="line">GGSCI&gt; CREATE SUBDIRS</span><br></pre></td></tr></table></figure></li><li><p>Create a Manager parameter file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GGSCI&gt; EDIT PARAM MGR </span><br><span class="line">PORT 7809</span><br><span class="line">DYNAMICPORTLIST 7810-7909</span><br></pre></td></tr></table></figure></li><li><p>Go to GGSCI, start the Manager, and check to see that it is running:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">GGSCI&gt;START MGR </span><br><span class="line">GGSCI&gt;INFO MGR</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="Source-Extract-Configure"><a href="#Source-Extract-Configure" class="headerlink" title="Source Extract Configure"></a>Source Extract Configure</h2><ol><li><p>Configure Capture Extract Process and Pump Extract Process</p><ul><li><p>Capture Extract Process Parameter<br><strong>Name:</strong> <code>egaehio.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">extract EGAEHIO </span><br><span class="line">statoptions reportfetch</span><br><span class="line">reportcount 15 minutes, rate</span><br><span class="line">encrypttrail AES128</span><br><span class="line">dynamicresolution </span><br><span class="line">useridalias ggadmin</span><br><span class="line">logallsupcols</span><br><span class="line">updaterecordformat compact</span><br><span class="line">tranlogoptions includeregionid</span><br><span class="line">dboptions allowunusedcolumn</span><br><span class="line">GETTRUNCATES</span><br><span class="line">exttrail ./dirdat/ga</span><br><span class="line">table EHTEMP.OGG_HADOOP_TEST;</span><br><span class="line">table EHTEMP.EMPLOYEES;</span><br></pre></td></tr></table></figure></li><li><p>Pump Extract Process Parameter<br><strong>Name:</strong> <code>pga_ga.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">extract PGA_GA</span><br><span class="line">passthru</span><br><span class="line">dynamicresolution</span><br><span class="line">reportcount 15 minutes, rate</span><br><span class="line">rmthost sjdevbigdtcon01, mgrport 7809, encrypt AES128</span><br><span class="line">rmttrail ./dirdat/ga</span><br><span class="line">table EHTEMP.OGG_HADOOP_TEST;</span><br><span class="line">table EHTEMP.EMPLOYEES;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Second, Start Capture and Pump Extract Process</p><ul><li>command<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;ggsci</span><br><span class="line">&gt;dblogin useridalias ggadmin</span><br><span class="line">&gt;add trandata EHTEMP.OGG_HADOOP_TEST </span><br><span class="line">&gt;add trandata EHTEMP.EMPLOYEES </span><br><span class="line">&gt;register extract egaehio database</span><br><span class="line">&gt;add extract egaehio, integrated tranlog, begin now</span><br><span class="line">&gt;add exttrail ./dirdat/ga, extract egaehio, megabytes 1000</span><br><span class="line">&gt;add extract pga_ga, exttrailsource ./dirdat/ga begin now</span><br><span class="line">&gt;add rmttrail ./dirdat/ga, extract pga_ga, megabytes 1000</span><br><span class="line">&gt;start extract egaehio</span><br><span class="line">&gt;start extract pga_ga</span><br></pre></td></tr></table></figure></li></ul></li></ol><h2 id="GoldenGate-Replicate-to-Redshift"><a href="#GoldenGate-Replicate-to-Redshift" class="headerlink" title="GoldenGate Replicate to Redshift"></a>GoldenGate Replicate to Redshift</h2><ol><li><p>Create Table on Redshift</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">DROP TABLE IF EXISTS employees CASCADE;</span><br><span class="line">commit;</span><br><span class="line">CREATE TABLE employees</span><br><span class="line">(</span><br><span class="line"> employee_id     bigint         NOT NULL,</span><br><span class="line"> first_name      varchar(20),</span><br><span class="line"> last_name       varchar(25),</span><br><span class="line"> email           varchar(25),</span><br><span class="line"> phone_number    varchar(20),</span><br><span class="line"> hire_date       date,</span><br><span class="line"> job_id          varchar(10),</span><br><span class="line"> salary          numeric(8,2),</span><br><span class="line"> commission_pct  numeric(2,2),</span><br><span class="line"> manager_id      bigint,</span><br><span class="line"> department_id   bigint</span><br><span class="line">);</span><br><span class="line">commit;</span><br><span class="line">ALTER TABLE employees</span><br><span class="line"> ADD CONSTRAINT pk_employees</span><br><span class="line"> PRIMARY KEY (employee_id);</span><br><span class="line">commit;</span><br></pre></td></tr></table></figure></li><li><p>Init Load Data<br><strong>On Source</strong></p><ul><li><p>Get SCN Filter Value</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select current_scn from v$databasse;</span><br></pre></td></tr></table></figure></li><li><p>Configure init Extract Process and Generate init trail file<br><strong>Name:</strong> <code>iegared.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sourceistable</span><br><span class="line">useridalias ggadmin</span><br><span class="line">RMTHOST sjdevbigdtcon01, MGRPORT 7809</span><br><span class="line">RMTFILE ./dirdat/iegared, MEGABYTES 2, PURGE</span><br><span class="line">table EHTEMP.EMPLOYEES,SQLPREDICATE &apos;AS OF SCN 61896071442&apos;;</span><br></pre></td></tr></table></figure><p><strong>Exec Below Command</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./extract paramfile dirprm/iegared.prm reportfile dirrpt/iegared.rpt</span><br></pre></td></tr></table></figure></li></ul><p><strong>On OGG Big Data Server</strong></p><ul><li><p>Configure Redshift JDBC Parameter<br><strong>Name:</strong> <code>jdbc_redshift.props</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">gg.handlerlist=jdbcwriter</span><br><span class="line">gg.handler.jdbcwriter.type=jdbc</span><br><span class="line">#Handler properties for Redshift database target</span><br><span class="line">gg.handler.jdbcwriter.DriverClass=com.amazon.redshift.jdbc.Driver</span><br><span class="line">gg.handler.jdbcwriter.connectionURL=jdbc:redshift://10.16.9.81:5439/dev</span><br><span class="line">gg.handler.jdbcwriter.userName=redadmin</span><br><span class="line">gg.handler.jdbcwriter.password=xxxxxxxx</span><br><span class="line">gg.classpath=/data/oggbg/jlib/RedshiftJDBC42-1.2.10.1009.jar</span><br><span class="line">goldengate.userexit.timestamp=utc</span><br><span class="line">goldengate.userexit.writers=javawriter</span><br><span class="line">javawriter.stats.display=TRUE</span><br><span class="line">javawriter.stats.full=TRUE</span><br><span class="line">gg.log=log4j</span><br><span class="line">gg.log.level=INFO</span><br><span class="line">gg.report.time=30sec</span><br><span class="line">javawriter.bootoptions=-Xmx512m -Xms32m -Djava.class.path=.:ggjava/ggjava.jar:./dirprm</span><br></pre></td></tr></table></figure></li><li><p>Configure init Replicat Process.<br><strong>Name:</strong> <code>irbigrd.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">specialrun</span><br><span class="line">end runtime</span><br><span class="line">EXTFILE ./dirdat/iegared</span><br><span class="line">DDL include all</span><br><span class="line">TARGETDB LIBFILE libggjava.so SET property=dirprm/jdbc_redshift.props</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES, RATE</span><br><span class="line">GROUPTRANSOPS 10000</span><br><span class="line">MAP EHTEMP.EMPLOYEES, TARGET public.EMPLOYEES;</span><br></pre></td></tr></table></figure><p><strong>Exec Below Command</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./replicat paramfile dirprm/irbigrd.prm reportfile dirrpt/irbigrd.rpt</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Configure Replicat Process<br><strong>Name:</strong> <code>rjdbcrd.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">REPLICAT rjdbcrd</span><br><span class="line">DDL include all</span><br><span class="line">DISCARDFILE ./dircrd/redshift.dsc</span><br><span class="line">TARGETDB LIBFILE libggjava.so SET property=dirprm/jdbc_redshift.props</span><br><span class="line">REPORTCOUNT EVERY 1 MINUTES, RATE</span><br><span class="line">GROUPTRANSOPS 1000</span><br><span class="line">MAP EHTEMP.EMPLOYEES, TARGET public.employees;</span><br></pre></td></tr></table></figure><p> <strong>Exec Below Command</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt;ggsci</span><br><span class="line">&gt;add replicat rjdbcrd, exttrail ./dirdat/ga</span><br><span class="line">&gt;start replicat rjdbcrd AFTERCSN 61896071442</span><br></pre></td></tr></table></figure></li></ol><h2 id="GoldenGate-Replicate-to-Flat-file"><a href="#GoldenGate-Replicate-to-Flat-file" class="headerlink" title="GoldenGate Replicate to Flat file"></a>GoldenGate Replicate to Flat file</h2><p>Oracle GoldenGate for Flat File outputs transactional data captured by Oracle GoldenGate to rolling flat files to be consumed by a third party product.Oracle GoldenGate for Flat File is implemented as a user exit provided as a shared library (.so or .dll) that integrates into the Oracle GoldenGate Extract process.<br>The user exit supports two modes of output:<br>● DSV . Delimiter Separated Values (commas are an example)<br>● LDV . Length Delimited Values</p><p>It can output data:<br>● All to one file<br>● One file per table<br>● One file per operation code</p><ol><li>Download GoldenGate Application Adapter<br>Copy <code>flatfilewriter.so</code> library to $OGG_HOME On OGG Big Data Server</li><li><p>Generate Table Define file<br><strong>Name:</strong> <code>egadef.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">defsfile ./dirdef/fflue.def, PURGE</span><br><span class="line">useridalias ggadmin</span><br><span class="line">table EHTEMP.OGG_HADOOP_TEST;</span><br><span class="line">table EHTEMP.EMPLOYEES;</span><br></pre></td></tr></table></figure><p> <strong>Exec Below Command</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./defgen paramfile ./dirprm/egadef.prm</span><br><span class="line">scp dirdef/fflue.def RemoteHost</span><br></pre></td></tr></table></figure></li><li><p>Configure Flat Handler Parameter<br><strong>Name:</strong> <code>ffue.properties</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">#------------------------</span><br><span class="line">#LOGGING OPTIONS</span><br><span class="line">#------------------------</span><br><span class="line">goldengate.log.logname=ffwriter</span><br><span class="line">goldengate.log.level=INFO</span><br><span class="line">goldengate.log.modules=LOGMALLOC</span><br><span class="line">goldengate.log.level.LOGMALLOC=ERROR</span><br><span class="line">goldengate.log.tostdout=false</span><br><span class="line">goldengate.log.tofile=true</span><br><span class="line">#------------------------</span><br><span class="line">#FLAT FILE WRITER OPTIONS</span><br><span class="line">#------------------------</span><br><span class="line">goldengate.flatfilewriter.writers=dsvwriter</span><br><span class="line">goldengate.userexit.chkptprefix=ffwriter_</span><br><span class="line">#------------------------</span><br><span class="line"># dsvwriter options</span><br><span class="line">#------------------------</span><br><span class="line">dsvwriter.mode=DSV</span><br><span class="line">dsvwriter.rawchars=false</span><br><span class="line">dsvwriter.includebefores=false</span><br><span class="line">dsvwriter.includecolnames=false</span><br><span class="line">dsvwriter.omitvalues=false</span><br><span class="line">dsvwriter.diffsonly=false</span><br><span class="line">dsvwriter.omitplaceholders=false</span><br><span class="line">#dsvwriter.files.onepertable=false</span><br><span class="line">dsvwriter.files.prefix=csv</span><br><span class="line">dsvwriter.files.data.rootdir=./dirout</span><br><span class="line">dsvwriter.files.data.ext=_data.dsv</span><br><span class="line">dsvwriter.files.data.tmpext=_data.dsv.temp</span><br><span class="line">dsvwriter.files.data.rollover.time=10</span><br><span class="line">#dsvwriter.files.data.rollover.size=</span><br><span class="line">dsvwriter.files.data.norecords.timeout=10</span><br><span class="line">dsvwriter.files.control.use=true</span><br><span class="line">dsvwriter.files.control.ext=_data.control</span><br><span class="line">dsvwriter.files.control.rootdir=./dirout</span><br><span class="line">dsvwriter.dsv.nullindicator.chars=&lt;NULL&gt;</span><br><span class="line">dsvwriter.dsv.fielddelim.chars=|</span><br><span class="line">dsvwriter.dsv.linedelim.chars=\n</span><br><span class="line">dsvwriter.dsv.quotes.chars=&quot;</span><br><span class="line">dsvwriter.dsv.quotes.escaped.chars=&quot;&quot;</span><br><span class="line">dsvwriter.metacols=position,txind,opcode,timestamp,schema,table</span><br><span class="line">dsvwriter.metacols.txind.fixedlen=1</span><br><span class="line">dsvwriter.metacols.txind.begin.chars=B</span><br><span class="line">dsvwriter.metacols.txind.middle.chars=M</span><br><span class="line">dsvwriter.metacols.txind.end.chars=E</span><br><span class="line">dsvwriter.files.formatstring=pump_%s_%t_%d_%05n</span><br><span class="line">#------------------------</span><br><span class="line"># ldvwriter options</span><br><span class="line">#------------------------</span><br><span class="line">ldvwriter.mode=LDV</span><br><span class="line">ldvwriter.rawchars=true</span><br><span class="line">ldvwriter.includebefores=false</span><br><span class="line">ldvwriter.includecolnames=false</span><br><span class="line">ldvwriter.files.onepertable=false</span><br><span class="line">ldvwriter.files.data.rootdir=./dirout</span><br><span class="line">ldvwriter.files.data.ext=.data</span><br><span class="line">ldvwriter.files.data.tmpext=.temp</span><br><span class="line">ldvwriter.files.data.rollover.time=10</span><br><span class="line">ldvwriter.files.data.norecords.timeout=10</span><br><span class="line">ldvwriter.files.control.use=true</span><br><span class="line">ldvwriter.files.control.ext=.ctrl</span><br><span class="line">ldvwriter.files.control.rootdir=./dirout</span><br><span class="line">ldvwriter.metacols=position,timestamp,@TOKEN-RBA,@TOKEN-POS,opcode,txind,schema,table</span><br><span class="line">ldvwriter.metacols.TOKEN-RBA.fixedlen=10</span><br><span class="line">ldvwriter.metacols.TOKEN-POS.fixedlen=10</span><br><span class="line">ldvwriter.metacols.timestamp.fixedlen=26</span><br><span class="line">ldvwriter.metacols.schema.fixedjustify=right</span><br><span class="line">ldvwriter.metacols.schema.fixedpadchar.chars=Y</span><br><span class="line">ldvwriter.metacols.opcode.fixedlen=1</span><br><span class="line">ldvwriter.metacols.opcode.insert.chars=I</span><br><span class="line">ldvwriter.metacols.opcode.update.chars=U</span><br><span class="line">ldvwriter.metacols.opcode.delete.chars=D</span><br><span class="line">ldvwriter.metacols.txind.fixedlen=1</span><br><span class="line">ldvwriter.metacols.txind.begin.chars=B</span><br><span class="line">ldvwriter.metacols.txind.middle.chars=M</span><br><span class="line">ldvwriter.metacols.txind.end.chars=E</span><br><span class="line">ldvwriter.metacols.txind.whole.chars=W</span><br><span class="line">ldvwriter.ldv.vals.missing.chars=M</span><br><span class="line">ldvwriter.ldv.vals.present.chars=P</span><br><span class="line">ldvwriter.ldv.vals.null.chars=N</span><br><span class="line">ldvwriter.ldv.lengths.record.mode=binary</span><br><span class="line">ldvwriter.ldv.lengths.record.length=4</span><br><span class="line">ldvwriter.ldv.lengths.field.mode=binary</span><br><span class="line">ldvwriter.ldv.lengths.field.length=2</span><br><span class="line">ldvwriter.files.rolloveronshutdown=false</span><br><span class="line">ldvwriter.statistics.toreportfile=false</span><br><span class="line">ldvwriter.statistics.period=onrollover</span><br><span class="line">ldvwriter.statistics.tosummaryfile=true</span><br><span class="line">ldvwriter.statistics.overall=true</span><br><span class="line">ldvwriter.statistics.summary.fileformat=schema,table,schemaandtable,total,gctimestamp,ctimestamp</span><br><span class="line">ldvwriter.statistics.summary.delimiter.chars=|</span><br><span class="line">ldvwriter.statistics.summary.eol.chars=\n</span><br><span class="line">ldvwriter.metacols.position.format=dec</span><br><span class="line">ldvwriter.writebuffer.size=36863</span><br></pre></td></tr></table></figure></li><li><p>Configure Flat Extract Process On OGG Big Data Server<br><strong>Name:</strong> <code>ffue.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Extract ffue</span><br><span class="line">CUserExit flatfilewriter.so CUSEREXIT PassThru IncludeUpdateBefores, PARAMS &quot;dirprm/ffue.properties&quot;</span><br><span class="line">SourceDefs dirsql/fflue.def</span><br><span class="line">table EHTEMP.OGG_HADOOP_TEST;</span><br><span class="line">table EHTEMP.EMPLOYEES;</span><br></pre></td></tr></table></figure></li><li><p>Init Load Data</p><ul><li><p>Get SCN Filter Value On Source</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select current_scn from v$databasse;</span><br></pre></td></tr></table></figure></li><li><p>Configure init extract process on source<br><strong>Name:</strong> <code>iegaffl.prm</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sourceistable</span><br><span class="line">useridalias ggadmin</span><br><span class="line">RMTHOST sjdevbigdtcon01, MGRPORT 7809</span><br><span class="line">RMTFILE ./dirdat/fi000000000, MEGABYTES 2, PURGE</span><br><span class="line">table EHTEMP.OGG_HADOOP_TEST,SQLPREDICATE &apos;AS OF SCN 61896417495&apos;;</span><br><span class="line">table EHTEMP.EMPLOYEES,SQLPREDICATE &apos;AS OF SCN 61896417495&apos;;</span><br></pre></td></tr></table></figure><p><strong>Exec Below Command On Source</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./extract paramfile dirprm/iegaffl.prm reportfile dirrpt/iegaffl.rpt</span><br></pre></td></tr></table></figure><p><strong>Exec Below Command On OGG Big Data Server</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; add extract ffue, extTrailSource dirdat/fi</span><br><span class="line">ggsci&gt; info ffue</span><br><span class="line">ggsci&gt; start extract ffue</span><br></pre></td></tr></table></figure></li></ul></li><li><p>Start Replicat Data Process<br><strong>Exec Below Command On OGG Big Data Server</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ggsci&gt; stop extract ffue</span><br><span class="line">ggsci&gt; delete extract ffue</span><br><span class="line">ggsci&gt; add extract ffue, extTrailSource dirdat/ga</span><br><span class="line">ggsci&gt; start extract ffue AFTERCSN 61896417495</span><br></pre></td></tr></table></figure></li></ol><h2 id="GoldenGate-Replicate-to-Flume"><a href="#GoldenGate-Replicate-to-Flume" class="headerlink" title="GoldenGate Replicate to Flume"></a>GoldenGate Replicate to Flume</h2><h3 id="Flume-Configure-and-Start"><a href="#Flume-Configure-and-Start" class="headerlink" title="Flume Configure and Start"></a>Flume Configure and Start</h3><h3 id="OGG-Big-Data-Replicat-to-Flume"><a href="#OGG-Big-Data-Replicat-to-Flume" class="headerlink" title="OGG Big Data Replicat to Flume"></a>OGG Big Data Replicat to Flume</h3><h2 id="GoldenGate-Replicate-to-Kafka"><a href="#GoldenGate-Replicate-to-Kafka" class="headerlink" title="GoldenGate Replicate to Kafka"></a>GoldenGate Replicate to Kafka</h2><h3 id="Kafka-Configure-and-Start"><a href="#Kafka-Configure-and-Start" class="headerlink" title="Kafka Configure and Start"></a>Kafka Configure and Start</h3><h3 id="OGG-Big-Data-Replicat-to-Kafka"><a href="#OGG-Big-Data-Replicat-to-Kafka" class="headerlink" title="OGG Big Data Replicat to Kafka"></a>OGG Big Data Replicat to Kafka</h3>]]></content>
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> OGG </tag>
            
            <tag> GoldenGate </tag>
            
        </tags>
      
    </entry>
    
    <entry>
      <title>Hexo博客搭建</title>
      <link href="/2018/07/18/Hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/"/>
      <url>/2018/07/18/Hexo%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
      <content type="html"><![CDATA[<h1 id="Windows环境Hexo博客搭建"><a href="#Windows环境Hexo博客搭建" class="headerlink" title="Windows环境Hexo博客搭建"></a>Windows环境Hexo博客搭建</h1><hr><h2 id="安装环境"><a href="#安装环境" class="headerlink" title="安装环境"></a>安装环境</h2><h3 id="安装Git-Bash"><a href="#安装Git-Bash" class="headerlink" title="安装Git Bash"></a>安装Git Bash</h3><ul><li>Windows: 下载并安装<a href="https://git-scm.com/download/win" target="_blank" rel="noopener">Git</a>.</li><li>Mac: 使用<a href="http://mxcl.github.com/homebrew/" target="_blank" rel="noopener">Homebrew</a>, <a href="http://www.macports.org/" target="_blank" rel="noopener">MacPorts</a> ：<code>brew install git</code>;或下载 <a href="http://sourceforge.net/projects/git-osx-installer/" target="_blank" rel="noopener">安装程序</a> 安装。</li><li>Linux(Ubuntu, Debian): <code>sudo apt-get install git-core</code></li><li>Linux(Fedora, Red Hat, CentOS): <code>sudo yum install git-core</code></li></ul><h3 id="安装NodeJs"><a href="#安装NodeJs" class="headerlink" title="安装NodeJs"></a>安装NodeJs</h3><p>Hexo是基于nodeJS环境的静态博客.</p><ul><li><a href="https://nodejs.org/en/" target="_blank" rel="noopener">下载地址</a>(说明：LTS为长期支持版，Current为当前最新版)</li><li>Windows可以采用exe或者下载zip包，添加环境变量的方式安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> node -v</span><br><span class="line">v10.6.0</span><br></pre></td></tr></table></figure></li></ul><h3 id="安装Hexo"><a href="#安装Hexo" class="headerlink" title="安装Hexo"></a>安装Hexo</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> npm i -g hexo</span><br><span class="line"><span class="meta">$</span> hexo -V</span><br><span class="line">hexo: 3.7.1</span><br><span class="line">hexo-cli: 1.1.0</span><br><span class="line">os: Windows_NT 6.1.7601 win32 x64</span><br><span class="line">http_parser: 2.8.0</span><br><span class="line">node: 10.6.0</span><br><span class="line">v8: 6.7.288.46-node.13</span><br><span class="line">uv: 1.21.0</span><br><span class="line">zlib: 1.2.11</span><br><span class="line">ares: 1.14.0</span><br><span class="line">modules: 64</span><br><span class="line">nghttp2: 1.32.0</span><br><span class="line">napi: 3</span><br><span class="line">openssl: 1.1.0h</span><br><span class="line">icu: 61.1</span><br><span class="line">unicode: 10.0</span><br><span class="line">cldr: 33.0</span><br><span class="line">tz: 2018c</span><br></pre></td></tr></table></figure><h2 id="生成Hexo博客"><a href="#生成Hexo博客" class="headerlink" title="生成Hexo博客"></a>生成Hexo博客</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>创建Blog目录</span><br><span class="line"><span class="meta">$</span> mkdir -p /opt/hexo</span><br><span class="line"><span class="meta">$</span> cd /opt/hexo</span><br><span class="line"><span class="meta">#</span>初始化hexo博客</span><br><span class="line"><span class="meta">$</span> hexo init</span><br><span class="line"><span class="meta">#</span>安装依赖包</span><br><span class="line"><span class="meta">$</span> npm install</span><br></pre></td></tr></table></figure><p>新建完成后，指定文件夹的目录如下<br><img src="/2018/07/18/Hexo博客搭建/image1.png" alt=""></p><ul><li>node_modules：是依赖包</li><li>public：存放的是生成的页面</li><li>scaffolds：命令生成文章等的模板</li><li>source：用命令创建的各种文章</li><li>themes：主题</li><li>_config.yml：整个博客的配置</li><li>db.json：source 解析所得到的</li><li>package.json：项目所需模块项目的配置信息</li></ul><h2 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h2><p>我使用的是屠城版Maupassant主题，它最初是由Cho大神为Typecho平台设计开发的一套响应式模板，体积只有20KB，在各种尺寸的设备上表现出色。由于其简洁大气的风格受到许多用户喜爱，目前也已经被移植到了多个平台上，例如：</p><ul><li><a href="https://github.com/pagecho/maupassant/" target="_blank" rel="noopener">Typecho</a> </li><li><a href="https://github.com/pagecho/mewpassant/" target="_blank" rel="noopener">Octopress</a></li><li><a href="https://github.com/pagecho/Maupassant-farbox/" target="_blank" rel="noopener">Farbox</a></li><li><a href="https://github.com/iMuFeng/maupassant/" target="_blank" rel="noopener">Wordpress</a></li><li><a href="https://github.com/LjxPrime/maupassant/" target="_blank" rel="noopener">Ghost</a></li><li><a href="https://github.com/tufu9441/maupassant-hexo" target="_blank" rel="noopener">屠城</a></li></ul><h3 id="主题安装"><a href="#主题安装" class="headerlink" title="主题安装"></a>主题安装</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> git clone https://github.com/tufu9441/maupassant-hexo.git themes/maupassant</span><br><span class="line"><span class="meta">$</span> npm install hexo-renderer-pug --save</span><br><span class="line"><span class="meta">$</span> npm install hexo-renderer-sass --save</span><br></pre></td></tr></table></figure><p>编辑Hexo目录下的 <code>_config.yml</code>，将 <code>theme</code> 的值改为 <code>maupassant</code> 和 <code>language</code> 的值改为 <code>zh-CN</code>。</p><p><strong>注：</strong>若 <code>npm install hexo-renderer-sass</code> 安装时报错，可能是国内网络问题，请尝试使用代理或者切换至<a href="http://npm.taobao.org/" target="_blank" rel="noopener">淘宝NPM镜像</a>安装，感谢光头强提供的方法。</p><h3 id="功能配置"><a href="#功能配置" class="headerlink" title="功能配置"></a>功能配置</h3><p>配置文件路径 <code>themes\maupassant\_config.yml</code><br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line">disqus: ## Your disqus_shortname, e.g. username</span><br><span class="line">uyan: ## Your uyan_id. e.g. 1234567</span><br><span class="line">livere: ## Your livere data-uid, e.g. MTAyMC8zMDAxOC78NTgz</span><br><span class="line">changyan: ## Your changyan appid, e.g. cyrALsXc8</span><br><span class="line">changyan_conf: ## Your changyan conf, e.g. prod_d8a508c2825ab57eeb43e7c69bba0e8b</span><br><span class="line">gitment:</span><br><span class="line">  enable: false ## If you want to use Gitment comment system please set the value to true.</span><br><span class="line">  owner: ## Your GitHub ID, e.g. username</span><br><span class="line">  repo: ## The repository to store your comments, make sure you're the repo's owner, e.g. imsun.github.io</span><br><span class="line">  client_id: ## GitHub client ID, e.g. 75752dafe7907a897619</span><br><span class="line">  client_secret: ## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50</span><br><span class="line">gitalk:</span><br><span class="line">  enable: false ## If you want to use Gitment comment system please set the value to true.</span><br><span class="line">  owner:  ## Your GitHub ID, e.g. username</span><br><span class="line">  repo:  ## The repository to store your comments, make sure you're the repo's owner, e.g. gitalk.github.io</span><br><span class="line">  client_id:  ## GitHub client ID, e.g. 75752dafe7907a897619</span><br><span class="line">  client_secret:  ## GitHub client secret, e.g. ec2fb9054972c891289640354993b662f4cccc50</span><br><span class="line">  admin:  ## Github repo owner and collaborators, only these guys can initialize github issues.</span><br><span class="line">valine: ## https://valine.js.org</span><br><span class="line">  enable: false ## If you want to use Valine comment system, please set the value to true.</span><br><span class="line">  appid: ## Your LeanCloud application App ID, e.g. pRBBL2JR4N7kLEGojrF0MsSs-gzGzoHsz</span><br><span class="line">  appkey: ## Your LeanCloud application App Key, e.g. tjczHpDfhjYDSYddzymYK1JJ</span><br><span class="line">  notify: false ## Mail notifier, see https://github.com/xCss/Valine/wiki/Valine-评论系统中的邮件提醒设置</span><br><span class="line">  verify: false ## Validation code.</span><br><span class="line">  placeholder: Just so so ## Comment box placeholders.</span><br><span class="line">  avatar: 'mm' ## Gravatar type, see https://github.com/xCss/Valine/wiki/avatar-setting-for-valine</span><br><span class="line">  pageSize: 10 ## Number of comments per page.</span><br><span class="line">  guest_info: nick,mail,link ## Attributes of reviewers.</span><br><span class="line"></span><br><span class="line">google_search: false ## Use Google search, true/false.</span><br><span class="line">baidu_search: false ## Use Baidu search, true/false.</span><br><span class="line">swiftype: ## Your swiftype_key, e.g. m7b11ZrsT8Me7gzApciT</span><br><span class="line">tinysou: ## Your tinysou_key, e.g. 4ac092ad8d749fdc6293</span><br><span class="line">self_search: true ## Use a jQuery-based local search engine, true/false.</span><br><span class="line">google_analytics: ## Your Google Analytics tracking id, e.g. UA-42425684-2</span><br><span class="line">baidu_analytics: ## Your Baidu Analytics tracking id, e.g. 8006843039519956000</span><br><span class="line">fancybox: true ## If you want to use fancybox please set the value to true.</span><br><span class="line">show_category_count: true ## If you want to show the count of categories in the sidebar widget please set the value to true.</span><br><span class="line">toc_number: true ## If you want to add list number to toc please set the value to true.</span><br><span class="line">shareto: true ## If you want to use the share button please set the value to true, and you must have hexo-helper-qrcode installed.</span><br><span class="line">busuanzi: false ## If you want to use Busuanzi page views please set the value to true.</span><br><span class="line">wordcount: false ## If you want to display the word counter and the reading time expected to spend of each post please set the value to true, and you must have hexo-wordcount installed.</span><br><span class="line">widgets_on_small_screens: false ## Set to true to enable widgets on small screens.</span><br><span class="line">canvas_nest:</span><br><span class="line">  enable: false ## If you want to use dynamic background please set the value to true, you can also fill the following parameters to customize the dynamic effect, or just leave them blank to keep the default effect.</span><br><span class="line">  color: ## RGB value of the color, e.g. "100,99,98"</span><br><span class="line">  opacity: ## Transparency of lines, e.g. "0.7"</span><br><span class="line">  zIndex: ## The z-index property of the background, e.g. "-1"</span><br><span class="line">  count: ## Quantity of lines, e.g. "150"</span><br><span class="line">donate:</span><br><span class="line">  enable: false ## If you want to display the donate button after each post, please set the value to true and fill the following items on your need. You can also enable donate button in a page by adding a "donate: true" item to the front-matter.</span><br><span class="line">  github: ## GitHub URL, e.g. https://github.com/Kaiyuan/donate-page</span><br><span class="line">  alipay_qr: ## Path of Alipay QRcode image, e.g. /img/AliPayQR.png</span><br><span class="line">  wechat_qr: ## Path of Wechat QRcode image, e.g. /img/WeChatQR.png</span><br><span class="line">  btc_qr: ## Path of Bitcoin QRcode image, e.g. /img/BTCQR.png</span><br><span class="line">  btc_key: ## Bitcoin key, e.g. 1KuK5eK2BLsqpsFVXXSBG5wbSAwZVadt6L</span><br><span class="line">  paypal_url: ## Paypal URL, e.g. https://www.paypal.me/tufu9441</span><br><span class="line">post_copyright:</span><br><span class="line">  enable: false ## If you want to display the copyright info after each post, please set the value to true and fill the following items on your need.</span><br><span class="line">  author: ## Your author name, e.g. tufu9441</span><br><span class="line">  copyright_text: ## Your copyright text, e.g. The author owns the copyright, please indicate the source reproduced.</span><br><span class="line"></span><br><span class="line">menu:</span><br><span class="line">  - page: 主页</span><br><span class="line">    directory: .</span><br><span class="line">    icon: fa-home</span><br><span class="line">  - page: 归档</span><br><span class="line">    directory: archives/</span><br><span class="line">    icon: fa-archive</span><br><span class="line">  - page: 关于</span><br><span class="line">    directory: about/</span><br><span class="line">    icon: fa-user</span><br><span class="line">  - page: 任务</span><br><span class="line">    directory: tasks/</span><br><span class="line">    icon: fa-tasks</span><br><span class="line">  - page: rss</span><br><span class="line">    directory: atom.xml</span><br><span class="line">    icon: fa-rss</span><br><span class="line">    </span><br><span class="line">widgets: ## Six widgets in sidebar provided: search, category, tag, recent_posts, rencent_comments and links.</span><br><span class="line">  - search</span><br><span class="line">  - category</span><br><span class="line">  - tag</span><br><span class="line">  - recent_posts</span><br><span class="line">  - recent_comments</span><br><span class="line">  - links</span><br><span class="line"></span><br><span class="line">links:</span><br><span class="line">  - title: site-name1</span><br><span class="line">    url: http://BowenZhuangOutlook.github.io</span><br><span class="line">  - title: site-name2</span><br><span class="line">    url: http://BowenZhuangOutlook.github.io</span><br><span class="line">  - title: site-name3</span><br><span class="line">    url: http://BowenZhuangOutlook.github.io</span><br><span class="line"></span><br><span class="line">timeline:</span><br><span class="line">  - num: 1</span><br><span class="line">    word: 2014/06/12-Start</span><br><span class="line">  - num: 2</span><br><span class="line">    word: 2014/11/29-XXX</span><br><span class="line">  - num: 3</span><br><span class="line">    word: 2015/02/18-DDD</span><br><span class="line">  - num: 4</span><br><span class="line">    word: More</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Static files</span><br><span class="line">js: js</span><br><span class="line">css: css</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> Theme version</span><br><span class="line">version: 0.0.0</span><br></pre></td></tr></table></figure></p><ul><li>fancybox - 是否启用 <a href="http://fancyapps.com/fancybox/" target="_blank" rel="noopener">Fancybox</a> 图片灯箱效果</li><li>disqus - <a href="https://disqus.com/" target="_blank" rel="noopener">Disqus评论</a> shortnam</li><li>uyan - <a href="http://www.uyan.cc/" target="_blank" rel="noopener">友言评论</a> id</li><li>livere - <a href="https://livere.com/" target="_blank" rel="noopener">来必力评论</a> data-uid</li><li>changyan - <a href="http://changyan.kuaizhan.com/" target="_blank" rel="noopener">畅言评论</a> appid</li><li>gitment - <a href="https://github.com/imsun/gitment" target="_blank" rel="noopener">Gitment</a> 评论相关参数</li><li>gitalk - <a href="https://github.com/gitalk/gitalk" target="_blank" rel="noopener">Gitalk</a> 评论相关参数</li><li>valine - <a href="https://valine.js.org/" target="_blank" rel="noopener">Valine</a> 评论相关参数</li><li>google_search - 默认使用Google搜索引擎</li><li>baidu_search - 若想使用百度搜索，将其设定为true。</li><li>swiftype - <a href="https://swiftype.com/" target="_blank" rel="noopener">Swiftype</a> 站内搜索key</li><li>tinysou - <a href="http://tinysou.com/" target="_blank" rel="noopener">微搜索</a> key</li><li>self_search - 基于jQuery的<a href="http://hahack.com/codes/local-search-engine-for-hexo" target="_blank" rel="noopener">本地搜索引擎</a>，需要安装 <a href="https://github.com/PaicHyperionDev/hexo-generator-search" target="_blank" rel="noopener">hexo-generator-search</a> 插件使用。</li><li>google_analytics - Google Analytics 跟踪ID</li><li>baidu_analytics - <a href="http://tongji.baidu.com/" target="_blank" rel="noopener">百度统计</a> 跟踪ID</li><li>show_category_count - 是否显示侧边栏分类数目</li><li>toc_number - 是否显示文章中目录列表自动编号</li><li>shareto - 是否使用分享按鈕，需要安装 <a href="https://github.com/yscoder/hexo-helper-qrcode" target="_blank" rel="noopener">hexo-helper-qrcode</a> 插件使用</li><li>busuanzi - 是否使用不蒜子页面访问计数</li><li>widgets_on_small_screens - 是否在移动设备屏幕底部显示侧边栏</li><li><a href="https://github.com/hustcc/canvas-nest.js/blob/master/README-zh.md" target="_blank" rel="noopener">canvas_nest</a> - 是否使用canvas动态背景</li><li>donate - 是否启用捐赠按钮</li><li>menu - 自定义页面及菜单，依照已有格式填写。填写后请在 <code>source</code> 目录下建立相应名称的文件夹，并包含 <code>index.md</code> 文件，以正确显示页面。导航菜单中集成了 <a href="http://fontawesome.io/" target="_blank" rel="noopener">FontAwesome</a> 图标字体，可以在这里选择新的图标，并按照相关说明使用。</li><li>widgets - 选择和排列希望使用的侧边栏小工具。</li><li>links - 友情链接，请依照格式填写。</li><li>timeline - 网站历史时间线，在页面<code>front-matter</code>中设置<code>layout: timeline</code>可显示。</li><li>Static files - 静态文件存储路径，方便设置CDN缓存。</li><li>Theme version - 主题版本，便于静态文件更新后刷新CDN缓存。</li></ul><h3 id="主题特性"><a href="#主题特性" class="headerlink" title="主题特性"></a>主题特性</h3><h4 id="网站图标"><a href="#网站图标" class="headerlink" title="网站图标"></a>网站图标</h4><p>若要设置网站 Favicon，可以将 favicon.ico 放在Hexo根目录的 <code>source</code> 文件夹下，建议的大小：32px*32px。</p><p>若要为网站添加苹果设备图标，请将命名为apple-touch-icon.png的图片放在同样的位置，建议的大小：114px*114px。</p><h4 id="文章摘要"><a href="#文章摘要" class="headerlink" title="文章摘要"></a>文章摘要</h4><p>首页默认显示文章摘要而非全文，可以在文章的front-matter中填写一项<code>description</code>:来设置你想显示的摘要，或者直接在文章内容中插入<a id="more"></a>以隐藏后面的内容。<br>若两者都未设置，则自动截取文章第一段作为摘要。</p><h4 id="添加页面"><a href="#添加页面" class="headerlink" title="添加页面"></a>添加页面</h4><p>在source目录下建立相应名称的文件夹，然后在文件夹中建立index.md文件，并在index.md的front-matter中设置layout为layout: page。若需要单栏页面，就将layout设置为 layout: single-column。</p><h4 id="文章目录"><a href="#文章目录" class="headerlink" title="文章目录"></a>文章目录</h4><p>在文章的front-matter中添加toc: true即可让该篇文章显示目录。</p><h4 id="文章评论"><a href="#文章评论" class="headerlink" title="文章评论"></a>文章评论</h4><p>文章和页面的评论功能可以通过在front-matter中设置comments: true或comments: false来进行开启或关闭（默认开启）。</p><h4 id="语法高亮"><a href="#语法高亮" class="headerlink" title="语法高亮"></a>语法高亮</h4><p>要启用代码高亮，请在Hexo目录的_config.yml中将highlight选项按照如下设置：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">highlight:</span><br><span class="line">  enable: true</span><br><span class="line">  auto_detect: true</span><br><span class="line">  line_number: true</span><br><span class="line">  tab_replace:</span><br></pre></td></tr></table></figure><h4 id="数学公式"><a href="#数学公式" class="headerlink" title="数学公式"></a>数学公式</h4><p>要启用数学公式支持，请在Hexo目录的_config.yml中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mathjax: true</span><br></pre></td></tr></table></figure></p><p>并在相应文章的front-matter中添加mathjax: true，例如：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">title: Test Math</span><br><span class="line">date: 2016-04-05 14:16:00</span><br><span class="line">categories: math</span><br><span class="line">mathjax: true</span><br><span class="line">---</span><br></pre></td></tr></table></figure></p><p>数学公式的默认定界符是$$…$$和\[…\]（对于块级公式），以及$…$和\(…\)（对于行内公式）。<br>但是，如果你的文章内容中经常出现美元符号“$”, 或者说你想将“$”用作美元符号而非行内公式的定界符，请在Hexo目录的_config.yml中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mathjax2: true</span><br></pre></td></tr></table></figure></p><p>而不是mathjax: true。 相应地，在需要使用数学公式的文章的front-matter中也添加mathjax2: true。</p><h4 id="支持语言"><a href="#支持语言" class="headerlink" title="支持语言"></a>支持语言</h4><p>目前支持简体中文（zh-CN），繁体中文（zh-TW），英语（en），法语（fr-FR），德语（de-DE），韩语（ko）和西班牙语（es-ES）。</p><h2 id="部署项目"><a href="#部署项目" class="headerlink" title="部署项目"></a>部署项目</h2><h3 id="Github创建repository"><a href="#Github创建repository" class="headerlink" title="Github创建repository"></a>Github创建repository</h3><ul><li>创建一个repo，名称为<code>yourname.github.io</code>, 其中yourname是你的github名称，按照这个规则创建才有用哦，如下：<br><img src="/2018/07/18/Hexo博客搭建/image2.png" alt="image2"></li><li>回到gitbash中，配置github账户信息（YourName和YourEail都替换成你自己的）：<br><img src="/2018/07/18/Hexo博客搭建/image3.png" alt="image3"><br><img src="/2018/07/18/Hexo博客搭建/image4.png" alt="image4"></li><li>创建SSH<br>在gitbash中输入：<code>ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</code>，生成ssh。然后按下图的方式找到id_rsa.pub文件的内容。<br><img src="/2018/07/18/Hexo博客搭建/image5.png" alt="image5"></li><li>将上面获取的ssh放到github中：添加一个 New SSH key ，title随便取，key就填刚刚那一段。<br><img src="/2018/07/18/Hexo博客搭建/image6.png" alt="image6"><br><img src="/2018/07/18/Hexo博客搭建/image7.png" alt="image7"></li><li>在gitbash中验证是否添加成功：ssh -T <a href="mailto:git@github.com" target="_blank" rel="noopener">git@github.com</a></li></ul><h3 id="配置Github并本地预览Hexo"><a href="#配置Github并本地预览Hexo" class="headerlink" title="配置Github并本地预览Hexo"></a>配置Github并本地预览Hexo</h3><ul><li><p>用编辑器打开你的blog项目，修改_config.yml文件的一些配置(冒号之后都是有一个半角空格的)：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: https://github.com/YourgithubName/YourgithubName.github.io.git</span><br><span class="line">  branch: master</span><br></pre></td></tr></table></figure></li><li><p>回到gitbash中，进入你的blog目录，分别执行以下命令：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo s -p 8088</span><br></pre></td></tr></table></figure></li><li><p>打开浏览器输入: <code>http://localhost:8088</code></p></li></ul><h3 id="上传到github"><a href="#上传到github" class="headerlink" title="上传到github"></a>上传到github</h3><ul><li>安装 <code>npm install hexo-deployer-git --save</code></li><li>执行命令(建议每次都按照如下步骤部署),注意deploy的过程中要输入你的username及passward:<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo clean</span><br><span class="line">hexo generate</span><br><span class="line">hexo deploy</span><br></pre></td></tr></table></figure></li></ul>]]></content>
      
      <categories>
          
          <category> 博客 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Hexo </tag>
            
            <tag> 博客 </tag>
            
            <tag> Github </tag>
            
        </tags>
      
    </entry>
    
  
  
</search>
